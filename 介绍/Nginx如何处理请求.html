<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>nginx 如何处理请求 | Nginx中文文档</title><meta name="description" content="不是很靠谱的翻译">
    <link rel="modulepreload" href="/nginxdoc/assets/app.138b5321.js"><link rel="modulepreload" href="/nginxdoc/assets/Nginx如何处理请求.html.6ee55d59.js"><link rel="modulepreload" href="/nginxdoc/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/nginxdoc/assets/Nginx如何处理请求.html.abb5aef5.js">
    <link rel="stylesheet" href="/nginxdoc/assets/style.49723153.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/nginxdoc/" class=""><!----><span class="site-name">Nginx中文文档</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">nginx 如何处理请求</p><ul class=""><li><!--[--><a aria-current="page" href="/nginxdoc/%E4%BB%8B%E7%BB%8D/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82.html#基于名称的虚拟服务器" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="基于名称的虚拟服务器"><!--[--><!--]--> 基于名称的虚拟服务器 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E4%BB%8B%E7%BB%8D/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82.html#如何使用未定义的-server-名称来阻止处理请求" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="如何使用未定义的 server 名称来阻止处理请求"><!--[--><!--]--> 如何使用未定义的 server 名称来阻止处理请求 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E4%BB%8B%E7%BB%8D/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82.html#基于名称和-ip-混合的虚拟服务器" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="基于名称和 IP 混合的虚拟服务器"><!--[--><!--]--> 基于名称和 IP 混合的虚拟服务器 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E4%BB%8B%E7%BB%8D/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82.html#一个简单的-php-站点配置" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="一个简单的 PHP 站点配置"><!--[--><!--]--> 一个简单的 PHP 站点配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E4%BB%8B%E7%BB%8D/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82.html#原文" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="原文"><!--[--><!--]--> 原文 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="nginx-如何处理请求" tabindex="-1"><a class="header-anchor" href="#nginx-如何处理请求" aria-hidden="true">#</a> nginx 如何处理请求</h1><ul><li><a href="#name_based_virtual_servers">基于名称的虚拟服务器</a></li><li><a href="#how_to_prevent_undefined_server_names">如何使用未定义的 server 名称来阻止处理请求</a></li><li><a href="#mixed_name_ip_based_servers">基于名称和 IP 混合的虚拟服务器</a></li><li><a href="#simple_php_site_configuration">一个简单的 PHP 站点配置</a></li></ul><p><a id="name_based_virtual_servers"></a></p><h2 id="基于名称的虚拟服务器" tabindex="-1"><a class="header-anchor" href="#基于名称的虚拟服务器" aria-hidden="true">#</a> 基于名称的虚拟服务器</h2><p>nginx 首先决定哪个 <code>server</code> 应该处理请求，让我们从一个简单的配置开始，三个虚拟服务器都监听了 <code>*:80</code> 端口：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.org www.example.org</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.net www.example.net</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com www.example.com</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>在此配置中，nginx 仅检验请求的 header 域中的 <code>Host</code>，以确定请求应该被路由到哪一个 <code>server</code>。如果其值与任何的 <code>server</code> 名称不匹配，或者该请求根本不包含此 header 域，nginx 会将请求路由到该端口的默认 <code>server</code> 中。在上面的配置中，默认 <code>server</code> 是第一个（这是 nginx 的标准默认行为）。你也可以在 <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#listen" target="_blank" rel="noopener noreferrer">listen<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 指令中使用 <code>default_server</code> 参数，明确地设置默认的 <code>server</code>。</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      <span class="token number">80</span> default_server</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.net www.example.net</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><code>default_server</code> 参数自 0.8.21 版本起可用。在早期版本中，应该使用 <code>default</code> 参数。</p></blockquote><p>请注意，<code>default_server</code> 是 <code>listen port</code> 的属性，而不是 <code>server_name</code> 的。之后会有更多关于这方面的内容。</p><p><a id="how_to_prevent_undefined_server_names"></a></p><h2 id="如何使用未定义的-server-名称来阻止处理请求" tabindex="-1"><a class="header-anchor" href="#如何使用未定义的-server-名称来阻止处理请求" aria-hidden="true">#</a> 如何使用未定义的 server 名称来阻止处理请求</h2><p>如果不允许没有 “Host” header 字段的请求，可以定义一个丢弃请求的 server：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">return</span>      <span class="token number">444</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这里的 <code>server</code> 名称设置为一个空字符串，会匹配不带 <code>Host</code> 的 header 域请求，nginx 会返回一个表示关闭连接的非标准代码 444。</p><blockquote><p>自 0.8.48 版本开始，这是 <code>server</code> 名称的默认设置，因此可以省略 <code>server name &quot;&quot;</code>。在早期版本中，机器的主机名被作为 <code>server</code> 的默认名称。</p></blockquote><p><a id="mixed_name_ip_based_servers"></a></p><h2 id="基于名称和-ip-混合的虚拟服务器" tabindex="-1"><a class="header-anchor" href="#基于名称和-ip-混合的虚拟服务器" aria-hidden="true">#</a> 基于名称和 IP 混合的虚拟服务器</h2><p>让我们看看更加复杂的配置，其中一些虚拟服务器监听在不同的 IP 地址上监听：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      192.168.1.1:80</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.org www.example.org</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      192.168.1.1:80</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.net www.example.net</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      192.168.1.2:80</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com www.example.com</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>此配置中，nginx 首先根据 <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#server" target="_blank" rel="noopener noreferrer">server<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 块的 <code>listen</code> 指令检验请求的 IP 和端口。之后，根据与 IP 和端口相匹配的 <code>server</code> 块的 <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#server_name" target="_blank" rel="noopener noreferrer">server_name<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 项对请求的“Host” header 域进行检验。如果找不到服务器的名称（server_name），请求将由 <code>default_server</code> 处理。例如，在 <code>192.168.1.1:80</code> 上收到的对 <code>www.example.com</code> 的请求将由 <code>192.168.1.1:80</code> 端口的 <code>default_server</code> （即第一个 server）处理，因为没有 <code>www.example.com</code> 在此端口上定义。</p><p>如上所述，<code>default_server</code> 是 <code>listen port</code> 的属性，可以为不同的端口定义不同的 <code>default_server</code>：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      192.168.1.1:80</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.org www.example.org</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      192.168.1.1:80 default_server</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.net www.example.net</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      192.168.1.2:80 default_server</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com www.example.com</span><span class="token punctuation">;</span>
    ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><a id="simple_php_site_configuration"></a></p><h2 id="一个简单的-php-站点配置" tabindex="-1"><a class="header-anchor" href="#一个简单的-php-站点配置" aria-hidden="true">#</a> 一个简单的 PHP 站点配置</h2><p>现在让我们来看看 nginx 是如何选择一个 <code>location</code> 来处理典型的简单 PHP 站点的请求：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span>      <span class="token number">80</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.org www.example.org</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">root</span>        /data/www</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">index</span>   index.html index.php</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|png)$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">fastcgi_pass</span>  localhost:9000</span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME
                      <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>
        <span class="token directive"><span class="token keyword">include</span>       fastcgi_params</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>nginx 首先忽略排序搜索具有最明确字符串的前缀 <code>location</code>。在上面的配置中，唯一有符合的是前缀 <code>location</code> 为 <code>/</code>，因为它匹配任何请求，它将被用作最后的手段。之后，nginx 按照配置文件中列出的顺序检查由 <code>location</code> 的正则表达式。第一个匹配表达式停止搜索，nginx 将使用此 <code>location</code>。如果没有正则表达式匹配请求，那么 nginx 将使用前面找到的最明确的前缀 <code>location</code>。</p><p>请注意，所有类型的 <code>location</code> 仅仅是检验请求的 URI 部分，不带参数。这样做是因为查询字符串中的参数可以有多种形式，例如：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/index.php?user=john&amp;page=1
/index.php?page=1&amp;user=john
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>此外，任何人都可以在查询字符串中请求任何内容：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>/index.php?page=1&amp;something+else&amp;user=john
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>现在来看看在上面的配置中是如何请求的：</p><ul><li>请求 <code>/logo.gif</code> 首先与 前缀 <code>location</code> 为 <code>/</code> 相匹配，然后由正则表达式 <code>\.(gif|jpg|png)$</code> 匹配，因此由后一个 <code>location</code> 处理。使用指令 <code>root /data/www</code> 将请求映射到 <code>/data/www/logo.gif</code> 文件，并将文件发送给客户端。</li><li>一个 <code>/index.php</code> 的请求也是首先与前缀 <code>location</code> 为 <code>/</code> 相匹配，然后是正则表达式 <code>\.(php)$</code>。因此，它由后一个 <code>location</code> 处理，请求将被传递给在 <code>localhost:9000</code> 上监听的 FastCGI 服务器。<a href="http://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_param" target="_blank" rel="noopener noreferrer">fastcgi_param<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 指令将 FastCGI 参数 <code>SCRPT_FILENAME</code> 设置为 <code>/data/www/index.php</code>，FastCGI 服务器执行该文件。变量 <code>$document_root</code> 与 <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#root" target="_blank" rel="noopener noreferrer">root<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 指令的值是一样的，变量 <code>$fastcgi_script_name</code> 的值为请求URI，即 <code>/index.php</code>。</li><li><code>/about.html</code> 请求仅与前缀 <code>location</code> 为 <code>/</code> 相匹配，因此由此 <code>location</code> 处理。使用指令 <code>root /data/www</code> 将请求映射到 <code>/data/www/about.html</code> 文件，并将文件发送给客户端。</li><li>处理请求 <code>/</code> 更复杂。它与前缀 <code>location</code> 为 <code>/</code> 相匹配。因此由该 <code>location</code> 处理。然后，<a href="http://nginx.org/en/docs/http/ngx_http_index_module.html#index" target="_blank" rel="noopener noreferrer">index<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 指令根据其参数和 <code>root /data/www</code> 指令检验索引文件是否存在。如果文件 <code>/data/www/index.html</code> 不存在，并且文件 <code>/data/www/index.php</code> 存在，则该指令执行内部重定向到 <code>/index.php</code>，如果请求是由客户端发起的，nginx 将再次搜索 <code>location</code>。如之前所述，重定向请求最终由 FastCGI 服务器处理。</li></ul><p>由 Igor Sysoev 撰写 由 Brian Mercer 编辑</p><h2 id="原文" tabindex="-1"><a class="header-anchor" href="#原文" aria-hidden="true">#</a> 原文</h2><ul><li><a href="http://nginx.org/en/docs/http/request_processing.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/http/request_processing.html<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">10/19/2021, 2:11:05 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: frisktale@live.com">frisktale</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/nginxdoc/assets/app.138b5321.js" defer></script>
  </body>
</html>
