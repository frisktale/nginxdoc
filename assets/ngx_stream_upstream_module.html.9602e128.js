import{r as l,c,a as t,b as s,w as r,F as d,d as a,e,o as i}from"./app.245ece3f.js";import{_ as p}from"./plugin-vue_export-helper.5a098b48.js";const h={},_=a('<h1 id="ngx-stream-upstream-module" tabindex="-1"><a class="header-anchor" href="#ngx-stream-upstream-module" aria-hidden="true">#</a> ngx_stream_upstream_module</h1><ul><li><a href="#example_configuration">\u793A\u4F8B\u914D\u7F6E</a></li><li><a href="#directives">\u6307\u4EE4</a><ul><li><a href="#upstream">upstream</a></li><li><a href="#server">server</a></li><li><a href="#zone">zone</a></li><li><a href="#state">state</a></li><li><a href="#hash">hash</a></li><li><a href="#least_conn">least_conn</a></li><li><a href="#least_time">least_time</a></li><li><a href="#random">random</a></li><li><a href="#resolver">resolver</a></li><li><a href="#resolver_timeout">resolver_timeout</a></li></ul></li><li><a href="#embedded_variables">\u5185\u90E8\u53D8\u91CF</a></li></ul>',2),u=t("code",null,"ngx_stream_upstream_module",-1),m=e(" \u6A21\u5757\uFF081.9.0\uFF09\u7528\u4E8E\u5B9A\u4E49\u53EF\u4EE5\u7531 "),g=e("proxy_pass"),b=e(" \u6307\u4EE4\u5F15\u7528\u7684\u670D\u52A1\u5668\u7EC4\u3002"),k=a(`<p><a id="example_configuration"></a></p><h2 id="\u793A\u4F8B\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B\u914D\u7F6E" aria-hidden="true">#</a> \u793A\u4F8B\u914D\u7F6E</h2><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$remote_addr</span> consistent</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backend1.example.com:12345  weight=5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend2.example.com:12345</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> unix:/tmp/backend3</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backup1.example.com:12345   backup</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backup2.example.com:12345   backup</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">12346</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> backend</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div>`,3),x=e("\u62E5\u6709\u5B9A\u671F\u8FD0\u884C"),v=e("\u5065\u5EB7\u68C0\u67E5"),f=e("\u7684\u52A8\u6001\u53EF\u914D\u7F6E\u7EC4\u4E3A"),y={href:"http://nginx.com/products/?_ga=2.130645319.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},w=e("\u5546\u4E1A\u8BA2\u9605"),E=e("\u90E8\u5206\uFF1A"),q=a(`<div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver</span> 10.0.0.1</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">upstream</span> dynamic</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">zone</span> upstream_dynamic <span class="token number">64k</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backend1.example.com:12345 weight=5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend2.example.com:12345 fail_timeout=5s slow_start=30s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.0.2.1:12345            max_fails=3</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend3.example.com:12345 resolve</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend4.example.com       service=http resolve</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backup1.example.com:12345  backup</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backup2.example.com:12345  backup</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">12346</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> dynamic</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">health_check</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><a id="directives"></a></p><h2 id="\u6307\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u6307\u4EE4" aria-hidden="true">#</a> \u6307\u4EE4</h2><h3 id="upstream" tabindex="-1"><a class="header-anchor" href="#upstream" aria-hidden="true">#</a> upstream</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>upstream</strong> <code>name { ... }</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>stream</td></tr></tbody></table><p>\u5B9A\u4E49\u4E00\u7EC4\u670D\u52A1\u5668\u3002\u670D\u52A1\u5668\u53EF\u4EE5\u5728\u4E0D\u540C\u7684\u7AEF\u53E3\u4E0A\u76D1\u542C\u3002\u6B64\u5916\uFF0C\u53EF\u4EE5\u5C06\u76D1\u542C TCP \u548C UNIX \u57DF\u5957\u63A5\u5B57\u7684\u670D\u52A1\u5668\u6DF7\u5408\u4F7F\u7528\u3002</p><p>\u793A\u4F8B\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> backend1.example.com:12345 weight=5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:12345            max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> unix:/tmp/backend2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend3.example.com:12345 resolve</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backup1.example.com:12345  backup</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>\u9ED8\u8BA4\u4F7F\u7528\u52A0\u6743\u8F6E\u8BE2\u5747\u8861\u7B97\u6CD5\u5728\u670D\u52A1\u5668\u95F4\u5206\u914D\u8FDE\u63A5\u3002\u5728\u4E0A\u9762\u7684\u793A\u4F8B\u4E2D\uFF0C\u6BCF 7 \u4E2A\u8FDE\u63A5\u5C06\u5982\u4E0B\u5206\u914D\uFF1A5 \u4E2A\u8FDE\u63A5\u8F6C\u5230 <code>backend1.example.com:12345</code>\uFF0C\u4E00\u4E2A\u8FDE\u63A5\u5230\u7B2C\u4E8C\u4E2A\u548C\u7B2C\u4E09\u4E2A\u670D\u52A1\u5668\u3002\u5982\u679C\u5728\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u671F\u95F4\u53D1\u751F\u9519\u8BEF\uFF0C\u5219\u8FDE\u63A5\u5C06\u88AB\u4F20\u9012\u5230\u4E0B\u4E00\u4E2A\u670D\u52A1\u5668\uFF0C\u4F9D\u6B64\u7C7B\u63A8\uFF0C\u76F4\u5230\u5C1D\u8BD5\u5B8C\u6240\u6709\u6B63\u5E38\u8FD0\u884C\u7684\u670D\u52A1\u5668\u4E3A\u6B62\u3002\u5982\u679C\u4E0E\u6240\u6709\u670D\u52A1\u5668\u7684\u901A\u4FE1\u90FD\u5931\u8D25\uFF0C\u5219\u8FDE\u63A5\u5C06\u5173\u95ED\u3002</p><h3 id="server" tabindex="-1"><a class="header-anchor" href="#server" aria-hidden="true">#</a> server</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>server</strong> <code>address [parameters]</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr></tbody></table><p>\u5B9A\u4E49\u670D\u52A1\u5668\u7684\u5730\u5740\uFF08<code>address</code>\uFF09\u548C\u5176\u4ED6\u53C2\u6570\u3002\u8BE5\u5730\u5740\u53EF\u4EE5\u6307\u5B9A\u4E3A\u5E26\u6709\u7AEF\u53E3\u7684\u57DF\u540D\u6216 IP \u5730\u5740\uFF0C\u4E5F\u53EF\u4EE5\u6307\u5B9A\u524D\u7F00\u4E3A <code>unix</code> \u7684 UNIX \u57DF\u5957\u63A5\u5B57\u8DEF\u5F84\u3002\u89E3\u6790\u4E3A\u591A\u4E2A IP \u5730\u5740\u7684\u57DF\u540D\u4E00\u6B21\u5B9A\u4E49\u4E86\u591A\u4E2A\u670D\u52A1\u5668\u3002</p><p>\u53EF\u4EE5\u5B9A\u4E49\u4EE5\u4E0B\u53C2\u6570\uFF1A</p>`,13),B=t("li",null,[t("p",null,[t("code",null,"weight=number")]),t("p",null,"\u8BBE\u7F6E\u670D\u52A1\u5668\u7684\u6743\u91CD\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4E3A 1\u3002")],-1),A=t("p",null,[t("code",null,"max_conns=number")],-1),z=t("p",null,[e("\u9650\u5236\u5230\u88AB\u4EE3\u7406\u670D\u52A1\u5668\u7684\u6700\u5927\u540C\u65F6\u8FDE\u63A5\u6570\uFF081.11.5\uFF09\u3002\u9ED8\u8BA4\u503C\u4E3A\u96F6\uFF0C\u8868\u793A\u6CA1\u6709\u9650\u5236\u3002\u5982\u679C\u670D\u52A1\u5668\u7EC4\u672A\u9A7B\u7559\u5728"),t("a",{href:"#zone"},"\u5171\u4EAB\u5185\u5B58"),e("\u4E2D\uFF0C\u5219\u6B64\u9650\u5236\u5728\u6BCF\u4E2A worker \u8FDB\u7A0B\u4E2D\u5747\u6709\u6548\u3002")],-1),D=e("\u5728 1.11.5 \u7248\u672C\u4E4B\u524D\uFF0C\u6B64\u53C2\u6570\u4F5C\u4E3A"),P={href:"http://nginx.com/products/?_ga=2.208745946.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},S=e("\u5546\u4E1A\u8BA2\u9605"),$=e("\u90E8\u5206\u3002"),F=a('<li><p><code>max_fails=number</code></p><p>\u8BBE\u7F6E\u5728 <code>fail_timeout</code> \u53C2\u6570\u8BBE\u7F6E\u7684\u65F6\u95F4\u5185\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u7684\u5931\u8D25\u5C1D\u8BD5\u6B21\u6570\uFF0C\u4EE5\u4FBF\u8BA4\u5B9A\u670D\u52A1\u5668\u5728 <code>fail_timeout</code> \u53C2\u6570\u8BBE\u7F6E\u7684\u65F6\u95F4\u5185\u4E0D\u53EF\u7528\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u5931\u8D25\u5C1D\u8BD5\u7684\u6B21\u6570\u8BBE\u7F6E\u4E3A 1\u3002\u96F6\u503C\u5C06\u7981\u7528\u5C1D\u8BD5\u8BB0\u5F55\u3002\u5728\u8FD9\u91CC\uFF0C\u5F53\u4E0E\u670D\u52A1\u5668\u6B63\u5728\u5EFA\u7ACB\u8FDE\u63A5\u4E2D\uFF0C\u5931\u8D25\u5C1D\u8BD5\u5C06\u662F\u4E00\u4E2A\u9519\u8BEF\u6216\u8D85\u65F6\u3002</p></li><li><p><code>fail_timeout=time</code></p><p>\u8BBE\u7F6E</p><ul><li>\u5728\u65F6\u95F4\u8303\u56F4\u5185\u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u7684\u5931\u8D25\u5C1D\u8BD5\u8FBE\u5230\u6307\u5B9A\u6B21\u6570\uFF0C\u5E94\u5C06\u670D\u52A1\u5668\u89C6\u4E3A\u4E0D\u53EF\u7528</li><li>\u670D\u52A1\u5668\u88AB\u89C6\u4E3A\u4E0D\u53EF\u7528\u7684\u65F6\u957F</li></ul><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u8BE5\u53C2\u6570\u8BBE\u7F6E\u4E3A 10 \u79D2\u3002</p></li><li><p><code>backup</code></p><p>\u5C06\u670D\u52A1\u5668\u6807\u8BB0\u4E3A\u5907\u7528\u670D\u52A1\u5668\u3002\u5F53\u4E3B\u670D\u52A1\u5668\u4E0D\u53EF\u7528\u65F6\uFF0C\u8FDE\u63A5\u5C06\u4F20\u9012\u5230\u5907\u7528\u670D\u52A1\u5668\u3002</p><blockquote><p>\u8BE5\u53C2\u6570\u4E0D\u80FD\u4E0E <a href="#hash">hash</a> \u548C <a href="#random">random</a> \u8D1F\u8F7D\u5747\u8861\u7B97\u6CD5\u4E00\u8D77\u4F7F\u7528\u3002</p></blockquote></li><li><p><code>down</code></p><p>\u5C06\u670D\u52A1\u5668\u6807\u8BB0\u4E3A\u6C38\u4E45\u4E0D\u53EF\u7528\u3002</p></li>',4),I=e("\u6B64\u5916\uFF0C\u4EE5\u4E0B\u53C2\u6570\u4F5C\u4E3A"),N={href:"http://nginx.com/products/?_ga=2.134173126.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},V=e("\u5546\u4E1A\u8BA2\u9605"),R=e("\u90E8\u5206\u63D0\u4F9B\uFF1A"),C=t("p",null,[t("code",null,"resolve")],-1),L=t("p",null,[e("\u76D1\u89C6\u4E0E\u670D\u52A1\u5668\u57DF\u540D\u76F8\u5BF9\u5E94\u7684 IP \u5730\u5740\u7684\u66F4\u6539\uFF0C\u5E76\u81EA\u52A8\u4FEE\u6539 upstream \u914D\u7F6E\uFF0C\u800C\u65E0\u9700\u91CD\u65B0\u542F\u52A8 nginx\u3002\u670D\u52A1\u5668\u7EC4\u5FC5\u987B\u9A7B\u7559\u5728"),t("a",{href:"#zone"},"\u5171\u4EAB\u5185\u5B58"),e("\u4E2D\u3002")],-1),T=e("\u4E3A\u4E86\u4F7F\u6B64\u53C2\u6570\u751F\u6548\uFF0C\u5FC5\u987B\u5728 "),M=e("stream"),U=e(" \u5757\u6216\u76F8\u5E94\u7684 "),X=t("a",{href:"#resolver"},"upstream",-1),j=e(" \u5757\u4E2D\u6307\u5B9A "),O=t("code",null,"resolver",-1),G=e(" \u6307\u4EE4\u3002"),H=t("p",null,[t("code",null,"service=name")],-1),J=e("\u542F\u7528 DNS "),K={href:"https://tools.ietf.org/html/rfc2782",target:"_blank",rel:"noopener noreferrer"},Q=e("SRV"),W=e(" \u8BB0\u5F55\u7684\u89E3\u6790\u5E76\u8BBE\u7F6E\u670D\u52A1\u540D\u79F0\uFF081.9.13\uFF09\u3002\u4E3A\u4E86\u4F7F\u6B64\u53C2\u6570\u751F\u6548\uFF0C\u5FC5\u987B\u4E3A\u670D\u52A1\u5668\u6307\u5B9A "),Y=t("a",{href:"#resolve"},"resolve",-1),Z=e(" \u53C2\u6570\uFF0C\u5E76\u6307\u5B9A\u4E0D\u5E26\u7AEF\u53E3\u53F7\u7684\u4E3B\u673A\u540D\u3002"),ee=e("\u5982\u679C\u670D\u52A1\u540D\u79F0\u4E0D\u5305\u542B\u70B9\uFF08"),te=t("code",null,".",-1),se=e("\uFF09\uFF0C\u5219\u6784\u9020\u7B26\u5408 "),ne={href:"https://tools.ietf.org/html/rfc2782",target:"_blank",rel:"noopener noreferrer"},ae=e("RFC"),oe=e(" \u7684\u540D\u79F0\uFF0C\u5E76\u5C06 TCP \u534F\u8BAE\u6DFB\u52A0\u5230\u670D\u52A1\u524D\u7F00\u3002\u4F8B\u5982\uFF0C\u8981\u67E5\u627E "),re=t("code",null,"_http._tcp.backend.example.com",-1),le=e(" SRV \u8BB0\u5F55\uFF0C\u5FC5\u987B\u6307\u5B9A\u6307\u4EE4\uFF1A"),ce=a(`<p>\u5982\u679C\u670D\u52A1\u540D\u79F0\u5305\u542B\u4E00\u4E2A\u6216\u591A\u4E2A\u70B9\uFF08<code>.</code>\uFF09\uFF0C\u5219\u901A\u8FC7\u5C06\u670D\u52A1\u524D\u7F00\u548C\u670D\u52A1\u5668\u540D\u79F0\u7ED3\u5408\u5728\u4E00\u8D77\u6765\u6784\u9020\u540D\u79F0\u3002\u4F8B\u5982\uFF0C\u8981\u67E5\u627E <code>_http._tcp.backend.example.com</code> \u548C <code>server1.backend.example.com</code> SRV \u8BB0\u5F55\uFF0C\u5FC5\u987B\u6307\u5B9A\u6307\u4EE4\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span> backend.example.com service=_http._tcp resolve</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">server</span> example.com service=server1.backend resolve</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>\u6700\u9AD8\u4F18\u5148\u7EA7\u7684 SRV \u8BB0\u5F55\uFF08\u5177\u6709\u76F8\u540C\u7684\u6700\u4F4E\u4F18\u5148\u7EA7\u503C\u7684\u8BB0\u5F55\uFF09\u88AB\u89E3\u6790\u4E3A\u4E3B\u670D\u52A1\u5668\uFF0C\u5176\u4F59\u7684 SRV \u8BB0\u5F55\u88AB\u89E3\u6790\u4E3A\u5907\u7528\u670D\u52A1\u5668\u3002\u5982\u679C\u4E3A\u670D\u52A1\u5668\u6307\u5B9A\u4E86 <a href="#backup">backup</a> \u53C2\u6570\uFF0C\u5219\u5C06\u9AD8\u4F18\u5148\u7EA7 SRV \u8BB0\u5F55\u89E3\u6790\u4E3A\u5907\u7528\u670D\u52A1\u5668\uFF0C\u5176\u4F59\u7684 SRV \u8BB0\u5F55\u5C06\u88AB\u5FFD\u7565\u3002</p>`,3),de=a('<li><p><code>slow_start=time</code></p><p>\u8BBE\u7F6E\u5F53\u670D\u52A1\u5668\u4ECE\u975E\u5065\u5EB7\u72B6\u6001\u8F6C\u4E3A\u5065\u5EB7\u72B6\u6001\u6216\u4E00\u6BB5\u65F6\u95F4<a href="#fail_timeout">\u4E0D\u53EF\u7528</a>\u540E\u8F6C\u4E3A\u53EF\u7528\u72B6\u6001\uFF0C\u670D\u52A1\u5668\u5C06\u5176\u6743\u91CD\u4ECE 0 \u6062\u590D\u5230\u539F\u503C\u7684\u65F6\u95F4\uFF08<code>time</code>\uFF09\u3002\u9ED8\u8BA4\u503C\u4E3A\u96F6\uFF0C\u5373\u7981\u7528\u6B64\u529F\u80FD\u3002</p><blockquote><p>\u8BE5\u53C2\u6570\u4E0D\u80FD\u4E0E <a href="#hash">hash</a> \u548C <a href="#random">random</a> \u8D1F\u8F7D\u5747\u8861\u7B97\u6CD5\u4E00\u8D77\u4F7F\u7528\u3002</p></blockquote></li>',1),ie=a('<p>\u5982\u679C\u7EC4\u4E2D\u53EA\u6709\u4E00\u53F0\u670D\u52A1\u5668\uFF0C\u5219\u5C06\u5FFD\u7565 <code>max_fails</code>\u3001<code>fail_timeout</code> \u548C <code>slow_start</code> \u53C2\u6570\uFF0C\u8FD9\u6837\u7684\u670D\u52A1\u5668\u5C06\u6C38\u8FDC\u4E0D\u4F1A\u88AB\u89C6\u4E3A\u4E0D\u53EF\u7528\u3002</p><h3 id="zone" tabindex="-1"><a class="header-anchor" href="#zone" aria-hidden="true">#</a> zone</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>zone</strong> <code>name [size]</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr></tbody></table><p>\u5B9A\u4E49\u5171\u4EAB\u5185\u5B58\u533A\u57DF\u7684\u540D\u79F0\uFF08<code>name</code>\uFF09\u548C\u5927\u5C0F\uFF08<code>size</code>\uFF09\uFF0C\u4EE5\u5B58\u50A8 worker \u8FDB\u7A0B\u4E4B\u95F4\u5171\u4EAB\u7684\u7EC4\u914D\u7F6E\u548C\u8FD0\u884C\u65F6\u72B6\u6001\u3002\u591A\u4E2A\u7EC4\u53EF\u5171\u4EAB\u540C\u4E00\u533A\u57DF\u3002\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\uFF0C\u4EC5\u6307\u5B9A\u4E00\u6B21\u5927\u5C0F\u5C31\u8DB3\u591F\u4E86\u3002</p>',4),pe=e("\u53E6\u5916\uFF0C\u5728"),he={href:"http://nginx.com/products/?_ga=2.171473384.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},_e=e("\u5546\u4E1A\u8BA2\u9605"),ue=e("\u90E8\u5206\u4E2D\uFF0C\u6B64\u7C7B\u7EC4\u5141\u8BB8\u66F4\u6539\u7EC4\u6210\u5458\u8EAB\u4EFD\u6216\u4FEE\u6539\u7279\u5B9A\u670D\u52A1\u5668\u7684\u8BBE\u7F6E\uFF0C\u800C\u65E0\u9700\u91CD\u65B0\u542F\u52A8 nginx\u3002\u53EF\u901A\u8FC7 "),me=e("API"),ge=e(" \u6A21\u5757\uFF081.13.3\uFF09\u8BBF\u95EE\u8BE5\u914D\u7F6E\u3002"),be=e("\u5728 1.13.3 \u7248\u672C\u4E4B\u524D\uFF0C\u53EA\u80FD\u8BBF\u95EE\u7279\u6B8A\u7684 location \u6765\u901A\u8FC7 "),ke=e("upstream_conf"),xe=e(" \u5904\u7406\u3002"),ve=a(`<h3 id="state" tabindex="-1"><a class="header-anchor" href="#state" aria-hidden="true">#</a> state</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>state</strong> <code>file</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr><tr><td style="text-align:right;"><strong>\u63D0\u793A</strong></td><td>\u8BE5\u6307\u4EE4\u5728 1.9.7 \u7248\u672C\u4E2D\u51FA\u73B0</td></tr></tbody></table><p>\u6307\u5B9A\u4E00\u4E2A\u6587\u4EF6\u7528\u4E8E\u4FDD\u5B58\u52A8\u6001\u53EF\u914D\u7F6E\u7EC4\u7684\u72B6\u6001\u3002</p><p>\u793A\u4F8B\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">state</span> /var/lib/nginx/state/servers.conf</span><span class="token punctuation">;</span> <span class="token comment"># path for Linux</span>
<span class="token directive"><span class="token keyword">state</span> /var/db/nginx/state/servers.conf</span><span class="token punctuation">;</span>  <span class="token comment"># path for FreeBSD</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>`,5),fe=e("\u5F53\u524D\u72B6\u6001\u4EC5\u9650\u4E8E\u5E26\u6709\u53C2\u6570\u7684\u670D\u52A1\u5668\u5217\u8868\u3002\u89E3\u6790\u914D\u7F6E\u65F6\u4F1A\u8BFB\u53D6\u8BE5\u6587\u4EF6\uFF0C\u5E76\u4E14\u6BCF\u6B21\u66F4\u6539 upstream \u914D\u7F6E\u65F6\u90FD\u4F1A"),ye=e("\u66F4\u65B0"),we=e("\u8BE5\u6587\u4EF6\u3002\u5E94\u907F\u514D\u76F4\u63A5\u66F4\u6539\u6587\u4EF6\u5185\u5BB9\u3002\u8BE5\u6307\u4EE4\u4E0D\u80FD\u4E0E "),Ee=t("a",{href:"#server"},"server",-1),qe=e(" \u6307\u4EE4\u4E00\u8D77\u4F7F\u7528\u3002"),Be=e("\u5728"),Ae=e("\u914D\u7F6E\u91CD\u65B0\u52A0\u8F7D"),ze=e("\u6216"),De=e("\u4E8C\u8FDB\u5236\u5347\u7EA7"),Pe=e("\u671F\u95F4\u6240\u505A\u7684\u66F4\u6539\u53EF\u80FD\u4F1A\u4E22\u5931\u3002"),Se=e("\u8BE5\u6307\u4EE4\u4E3A"),$e={href:"http://nginx.com/products/?_ga=2.128922308.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},Fe=e("\u5546\u4E1A\u8BA2\u9605"),Ie=e("\u90E8\u5206\u3002"),Ne=a(`<h3 id="hash" tabindex="-1"><a class="header-anchor" href="#hash" aria-hidden="true">#</a> hash</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>hash</strong> <code>key [consistent]</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr></tbody></table><p>\u6307\u5B9A\u670D\u52A1\u5668\u7EC4\u7684\u8D1F\u8F7D\u5747\u8861\u7B97\u6CD5\uFF0C\u5728\u8BE5\u670D\u52A1\u5668\u7EC4\u4E2D\uFF0C\u5BA2\u6237\u7AEF\u2014\u2014\u670D\u52A1\u5668\u7684\u6620\u5C04\u57FA\u4E8E\u54C8\u5E0C\u952E\u503C\uFF08key/value\uFF09\u3002key \u53EF\u4EE5\u5305\u542B\u6587\u672C\u3001\u53D8\u91CF\u53CA\u5176\u7EC4\u5408\uFF081.11.2\uFF09\u3002 \u7528\u6CD5\u793A\u4F8B\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>`,4),Ve=e("\u8BF7\u6CE8\u610F\uFF0C\u4ECE\u7EC4\u4E2D\u6DFB\u52A0\u6216\u5220\u9664\u670D\u52A1\u5668\u53EF\u80FD\u4F1A\u5BFC\u81F4\u5927\u91CF key \u91CD\u65B0\u6620\u5C04\u5230\u5176\u4ED6\u670D\u52A1\u5668\u3002\u8BE5\u65B9\u6CD5\u4E0E "),Re={href:"https://metacpan.org/pod/Cache::Memcached",target:"_blank",rel:"noopener noreferrer"},Ce=e("Cache::Memcached"),Le=e(" Perl \u5E93\u517C\u5BB9\u3002"),Te=e("\u5982\u679C\u6307\u5B9A\u4E86 "),Me=t("code",null,"consistent",-1),Ue=e(" \u53C2\u6570\uFF0C\u5219\u5C06\u4F7F\u7528 "),Xe={href:"https://www.metabrew.com/article/libketama-consistent-hashing-algo-memcached-clients",target:"_blank",rel:"noopener noreferrer"},je=e("ketama"),Oe=e(" \u4E00\u81F4\u6027\u54C8\u5E0C\u7B97\u6CD5\u3002\u8BE5\u65B9\u6CD5\u53EF\u786E\u4FDD\u5728\u5C06\u670D\u52A1\u5668\u6DFB\u52A0\u5230\u7EC4\u4E2D\u6216\u4ECE\u7EC4\u4E2D\u5220\u9664\u670D\u52A1\u5668\u65F6\uFF0C\u53EA\u6709\u5F88\u5C11\u7684 key \u88AB\u91CD\u65B0\u6620\u5C04\u5230\u4E0D\u540C\u7684\u670D\u52A1\u5668\u3002\u8FD9\u6709\u52A9\u4E8E\u7F13\u5B58\u670D\u52A1\u5668\u5B9E\u73B0\u66F4\u9AD8\u7684\u7F13\u5B58\u547D\u4E2D\u7387\u3002\u8BE5\u65B9\u6CD5\u4E0E "),Ge=t("code",null,"ketama_points",-1),He=e(" \u53C2\u6570\u8BBE\u7F6E\u4E3A 160 \u7684 "),Je={href:"https://metacpan.org/pod/Cache::Memcached::Fast",target:"_blank",rel:"noopener noreferrer"},Ke=e("Cache::Memcached::Fast"),Qe=e(" Perl \u5E93\u517C\u5BB9\u3002"),We=a('<h3 id="least-conn" tabindex="-1"><a class="header-anchor" href="#least-conn" aria-hidden="true">#</a> least_conn</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>least_conn</strong>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr></tbody></table><p>\u6307\u5B9A\u7EC4\u4F7F\u7528\u7684\u8D1F\u8F7D\u5747\u8861\u7B97\u6CD5\uFF0C\u5176\u5C06\u8FDE\u63A5\u4F20\u9012\u5230\u6D3B\u52A8\u8FDE\u63A5\u6570\u6700\u5C11\u7684\u670D\u52A1\u5668\uFF0C\u540C\u65F6\u8981\u8003\u8651\u670D\u52A1\u5668\u7684\u6743\u91CD\u3002\u5982\u679C\u6709\u591A\u4E2A\u8FD9\u6837\u7684\u670D\u52A1\u5668\uFF0C\u5219\u4F9D\u6B21\u4F7F\u7528\u52A0\u6743\u8F6E\u8BE2\u5747\u8861\u7B97\u6CD5\u8FDB\u884C\u5C1D\u8BD5\u3002</p><h3 id="least-time" tabindex="-1"><a class="header-anchor" href="#least-time" aria-hidden="true">#</a> least_time</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>least_time</strong> <code>connect</code> | <code>first_byte</code> | <code>last_byte</code> <code>[inflight]</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr></tbody></table><p>\u6307\u5B9A\u7EC4\u5E94\u4F7F\u7528\u7684\u8D1F\u8F7D\u5747\u8861\u7B97\u6CD5\uFF0C\u5176\u5C06\u8FDE\u63A5\u4F20\u9012\u5230\u5E73\u5747\u65F6\u95F4\u6700\u5C11\u4E14\u6D3B\u52A8\u8FDE\u63A5\u6570\u6700\u5C11\u7684\u670D\u52A1\u5668\uFF0C\u540C\u65F6\u8003\u8651\u670D\u52A1\u5668\u7684\u6743\u91CD\u3002\u5982\u679C\u6709\u591A\u4E2A\u8FD9\u6837\u7684\u670D\u52A1\u5668\uFF0C\u5219\u4F9D\u6B21\u4F7F\u7528\u52A0\u6743\u8F6E\u8BE2\u5747\u8861\u7B97\u6CD5\u8FDB\u884C\u5C1D\u8BD5\u3002</p><p>\u5982\u679C\u6307\u5B9A\u4E86 <code>connect</code> \u53C2\u6570\uFF0C\u5219\u4F7F\u7528<a href="#var_upstream_connect_time">\u8FDE\u63A5</a>\u5230 upstream \u670D\u52A1\u5668\u7684\u65F6\u95F4\u3002\u5982\u679C\u6307\u5B9A\u4E86 <code>first_byte</code> \u53D8\u91CF\uFF0C\u5219\u4F7F\u7528\u63A5\u6536\u6570\u636E\u7684<a href="#var_upstream_first_byte_time">\u9996\u5B57\u8282</a>\u7684\u65F6\u95F4\u3002\u5982\u679C\u6307\u5B9A\u4E86 <code>last_byte</code>\uFF0C\u5219\u4F7F\u7528\u63A5\u6536\u6570\u636E<a href="#var_upstream_session_time">\u5C3E\u5B57\u8282</a>\u7684\u65F6\u95F4\u3002\u5982\u679C\u6307\u5B9A\u4E86 <code>inflight</code> \u53C2\u6570\uFF081.11.6\uFF09\uFF0C\u8FD8\u5C06\u8003\u8651\u4E0D\u5B8C\u6574\u8FDE\u63A5\u3002</p><blockquote><p>\u5728 1.11.6 \u7248\u672C\u4E4B\u524D\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u4F1A\u8003\u8651\u4E0D\u5B8C\u6574\u7684\u8FDE\u63A5\u3002</p></blockquote>',8),Ye=e("\u8BE5\u6307\u4EE4\u4F5C\u4E3A"),Ze={href:"http://nginx.com/products/?_ga=2.162551156.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},et=e("\u5546\u4E1A\u8BA2\u9605"),tt=e("\u90E8\u5206\u3002"),st=a('<h3 id="random" tabindex="-1"><a class="header-anchor" href="#random" aria-hidden="true">#</a> random</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>random</strong> <code>[two [method]]</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr><tr><td style="text-align:right;"><strong>\u63D0\u793A</strong></td><td>\u8BE5\u6307\u4EE4\u5728 1.15.1 \u7248\u672C\u4E2D\u51FA\u73B0</td></tr></tbody></table><p>\u6307\u5B9A\u7EC4\u5E94\u4F7F\u7528\u7684\u8D1F\u8F7D\u5747\u8861\u7B97\u6CD5\uFF0C\u5176\u5C06\u8FDE\u63A5\u4F20\u9012\u5230\u968F\u673A\u9009\u62E9\u7684\u670D\u52A1\u5668\uFF0C\u540C\u65F6\u8981\u8003\u8651\u670D\u52A1\u5668\u7684\u6743\u91CD\u3002</p>',3),nt=e("\u53EF\u9009\u7684\u4E24\u4E2A\u53C2\u6570\u6307\u793A nginx \u968F\u673A\u9009\u62E9"),at={href:"https://homes.cs.washington.edu/~karlin/papers/balls.pdf",target:"_blank",rel:"noopener noreferrer"},ot=e("\u4E24\u4E2A"),rt=e("\u670D\u52A1\u5668\uFF0C\u7136\u540E\u4F7F\u7528\u6307\u5B9A\u7684\u7B97\u6CD5\uFF08"),lt=t("code",null,"method",-1),ct=e("\uFF09\u9009\u62E9\u4E00\u4E2A\u670D\u52A1\u5668\u3002\u9ED8\u8BA4\u65B9\u6CD5\u662F "),dt=t("code",null,"minimum_conn",-1),it=e("\uFF0C\u5B83\u5C06\u8FDE\u63A5\u4F20\u9012\u5230\u6D3B\u52A8\u8FDE\u63A5\u6570\u6700\u5C11\u7684\u670D\u52A1\u5668\u3002"),pt=a('<p><code>minimum_time</code> \u7B97\u6CD5\u5C06\u8FDE\u63A5\u4F20\u9012\u5230\u5E73\u5747\u65F6\u95F4\u6700\u5C11\u4E14\u6D3B\u52A8\u8FDE\u63A5\u6570\u6700\u5C11\u7684\u670D\u52A1\u5668\u3002\u5982\u679C\u6307\u5B9A\u4E86 <code>least_time=connect</code> \u53C2\u6570\uFF0C\u5219\u4F7F\u7528<a href="#var_upstream_connect_time">\u8FDE\u63A5</a>\u5230 upstream \u670D\u52A1\u5668\u7684\u65F6\u95F4\u3002\u5982\u679C\u6307\u5B9A\u4E86 <code>least_time=first_byte</code> \u53C2\u6570\uFF0C\u5219\u4F7F\u7528\u63A5\u6536\u6570\u636E\u7684<a href="#var_upstream_first_byte_time">\u9996\u5B57\u8282</a>\u7684\u65F6\u95F4\u3002\u5982\u679C\u6307\u5B9A\u4E86 <code>least_time=last_byte</code>\uFF0C\u5982\u679C\u6307\u5B9A\u4E86 <code>last_byte</code>\uFF0C\u5219\u4F7F\u7528\u63A5\u6536\u6570\u636E<a href="#var_upstream_session_time">\u5C3E\u5B57\u8282</a>\u7684\u65F6\u95F4\u3002</p>',1),ht=t("code",null,"least_time",-1),_t=e(" \u7B97\u6CD5\u662F"),ut={href:"http://nginx.com/products/?_ga=2.200372710.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},mt=e("\u5546\u4E1A\u8BA2\u9605"),gt=e("\u90E8\u5206\u3002"),bt=a(`<h3 id="resolver" tabindex="-1"><a class="header-anchor" href="#resolver" aria-hidden="true">#</a> resolver</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>resolver</strong> <code>address ... [valid=time] [ipv6=on|off] [status_zone=zone]</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr><tr><td style="text-align:right;"><strong>\u63D0\u793A</strong></td><td>\u8BE5\u6307\u4EE4\u5728 1.17.5 \u7248\u672C\u4E2D\u51FA\u73B0</td></tr></tbody></table><p>\u914D\u7F6E\u7528\u4E8E\u5C06 upstream \u670D\u52A1\u5668\u7684\u540D\u79F0\u89E3\u6790\u4E3A\u5730\u5740\u7684\u540D\u79F0\u670D\u52A1\u5668\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver</span> 127.0.0.1 [::1]:5353</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>\u53EF\u4EE5\u5C06\u5730\u5740\u6307\u5B9A\u4E3A\u57DF\u540D\u6216 IP \u5730\u5740\uFF0C\u914D\u7F6E\u4E00\u4E2A\u53EF\u9009\u7AEF\u53E3\u3002\u5982\u679C\u672A\u6307\u5B9A\u7AEF\u53E3\uFF0C\u5219\u4F7F\u7528 53 \u7AEF\u53E3\u3002\u4EE5\u8F6E\u8BE2\u7B97\u6CD5\u67E5\u627E\u540D\u79F0\u670D\u52A1\u5668\u3002</p><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cnginx \u5728\u89E3\u6790\u65F6\u5C06\u540C\u65F6\u67E5\u627E IPv4 \u548C IPv6 \u5730\u5740\u3002\u5982\u679C\u4E0D\u9700\u8981\u67E5\u627E IPv6 \u5730\u5740\uFF0C\u5219\u53EF\u4EE5\u6307\u5B9A <code>ipv6=off</code> \u53C2\u6570\u3002</p><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Cnginx \u4F7F\u7528\u54CD\u5E94\u7684 TTL \u503C\u7F13\u5B58\u56DE\u590D\u3002\u53EF\u9009\u7684 <code>valid</code> \u53C2\u6570\u8986\u76D6\u9ED8\u8BA4\u884C\u4E3A\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver</span> 127.0.0.1 [::1]:5353 valid=30s</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>\u4E3A\u9632\u6B62 DNS \u6B3A\u9A97\uFF0C\u5EFA\u8BAE\u5728\u4E00\u4E2A\u53D7\u5230\u4FDD\u62A4\u7684\u53EF\u4FE1\u672C\u5730\u7F51\u7EDC\u4E2D\u914D\u7F6E DNS \u670D\u52A1\u5668\u3002</p></blockquote>`,9),kt=e("\u53EF\u9009\u7684 "),xt=t("code",null,"status_zone",-1),vt=e(" \u53C2\u6570\u542F\u7528\u5BF9\u6307\u5B9A\u533A\u57DF\u4E2D\u8BF7\u6C42\u548C\u54CD\u5E94\u7684 DNS \u670D\u52A1\u5668\u7EDF\u8BA1\u4FE1\u606F\u7684"),ft=e("\u6536\u96C6"),yt=e("\u3002"),wt=e("\u8BE5\u6307\u4EE4\u4E3A"),Et={href:"http://nginx.com/products/?_ga=2.175591914.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},qt=e("\u5546\u4E1A\u8BA2\u9605"),Bt=e("\u90E8\u5206\u3002"),At=a(`<h3 id="resolver-timeout" tabindex="-1"><a class="header-anchor" href="#resolver-timeout" aria-hidden="true">#</a> resolver_timeout</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>resolver_timeout</strong> <code>time</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>resolver_timeout 30s;</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>upstream</td></tr><tr><td style="text-align:right;"><strong>\u63D0\u793A</strong></td><td>\u8BE5\u6307\u4EE4\u5728 1.17.5 \u7248\u672C\u4E2D\u51FA\u73B0</td></tr></tbody></table><p>\u4E3A\u540D\u79F0\u89E3\u6790\u8BBE\u7F6E\u4E00\u4E2A\u8D85\u65F6\u65F6\u95F4\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver_timeout</span> <span class="token number">5s</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>`,4),zt=e("\u8BE5\u6307\u4EE4\u4E3A"),Dt={href:"http://nginx.com/products/?_ga=2.133192262.99786210.1588592638-1615340879.1588592638",target:"_blank",rel:"noopener noreferrer"},Pt=e("\u5546\u4E1A\u8BA2\u9605"),St=e("\u90E8\u5206\u3002"),$t=a('<p><a id="embedded_variables"></a></p><h2 id="\u5185\u90E8\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#\u5185\u90E8\u53D8\u91CF" aria-hidden="true">#</a> \u5185\u90E8\u53D8\u91CF</h2><p><code>ngx_stream_upstream_module</code> \u6A21\u5757\u652F\u6301\u4EE5\u4E0B\u5185\u90E8\u53D8\u91CF\uFF1A</p><ul><li><p><code>$upstream_addr</code></p><p>\u4FDD\u7559 IP \u5730\u5740\u548C\u7AEF\u53E3\u6216 upstream \u670D\u52A1\u5668\u7684 UNIX \u57DF\u5957\u63A5\u5B57\uFF081.11.4\uFF09\u8DEF\u5F84\u3002\u5982\u679C\u5728\u4EE3\u7406\u8FC7\u7A0B\u4E2D\u8054\u7CFB\u4E86\u591A\u4E2A\u670D\u52A1\u5668\uFF0C\u5219\u5B83\u4EEC\u7684\u5730\u5740\u7528\u9017\u53F7\u5206\u9694\uFF0C\u4F8B\u5982 <code>192.168.1.1:12345, 192.168.1.2:12345, unix:/tmp/sock</code>\u3002\u5982\u679C\u65E0\u6CD5\u9009\u62E9\u670D\u52A1\u5668\uFF0C\u5219\u8BE5\u53D8\u91CF\u5C06\u4FDD\u7559\u670D\u52A1\u5668\u7EC4\u7684\u540D\u79F0\u3002</p></li><li><p><code>$upstream_bytes_received</code></p><p>\u4ECE upstream \u670D\u52A1\u5668\u6536\u5230\u7684\u5B57\u8282\u6570\uFF081.11.4\uFF09\u3002\u6765\u81EA\u591A\u4E2A\u8FDE\u63A5\u7684\u503C\u4F7F\u7528\u9017\u53F7\u5206\u9694\uFF0C\u53C2\u8003 <code>$upstream_addr</code> \u53D8\u91CF\u4E2D\u7684\u5730\u5740\u3002</p></li><li><p><code>$upstream_bytes_sent</code></p><p>\u53D1\u9001\u5230 upstream \u670D\u52A1\u5668\u7684\u5B57\u8282\u6570\uFF081.11.4\uFF09\u3002\u6765\u81EA\u591A\u4E2A\u8FDE\u63A5\u7684\u503C\u4F7F\u7528\u9017\u53F7\u5206\u9694\uFF0C\u53C2\u8003 <code>$upstream_addr</code> \u53D8\u91CF\u4E2D\u7684\u5730\u5740\u3002</p></li><li><p><code>$upstream_connect_time</code></p><p>\u8FDE\u63A5 upstream \u670D\u52A1\u5668\u7684\u65F6\u95F4\uFF081.11.4\uFF09\uFF0C\u65F6\u95F4\u4EE5\u6BEB\u79D2\u4E3A\u5355\u4F4D\uFF0C\u4EE5\u79D2\u4E3A\u5355\u4F4D\u3002\u591A\u4E2A\u8FDE\u63A5\u7684\u65F6\u95F4\u7528\u9017\u53F7\u5206\u9694\uFF0C\u53C2\u8003 <code>$upstream_addr</code> \u53D8\u91CF\u4E2D\u7684\u5730\u5740\u3002</p></li><li><p><code>$upstream_first_byte_time</code></p><p>\u63A5\u6536\u6570\u636E\u7684\u7B2C\u4E00\u4E2A\u5B57\u8282\u7684\u65F6\u95F4\uFF081.11.4\uFF09\uFF0C\u65F6\u95F4\u4EE5\u6BEB\u79D2\u4E3A\u5355\u4F4D\uFF0C\u4EE5\u79D2\u4E3A\u5355\u4F4D\u3002\u591A\u4E2A\u8FDE\u63A5\u7684\u65F6\u95F4\u7528\u9017\u53F7\u5206\u9694\uFF0C\u53C2\u8003 <code>$upstream_addr</code> \u53D8\u91CF\u4E2D\u7684\u5730\u5740\u3002</p></li><li><p><code>$upstream_session_time</code></p><p>\u4F1A\u8BDD\u6301\u7EED\u65F6\u95F4\uFF0C\u4EE5\u6BEB\u79D2\u4E3A\u5355\u4F4D\uFF0C\u4EE5\u6BEB\u79D2\u4E3A\u5355\u4F4D\uFF081.11.4\uFF09\u3002\u591A\u4E2A\u8FDE\u63A5\u7684\u65F6\u95F4\u7528\u9017\u53F7\u5206\u9694\uFF0C\u53C2\u8003 <code>$upstream_addr</code> \u53D8\u91CF\u4E2D\u7684\u5730\u5740\u3002</p></li></ul><h2 id="\u539F\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#\u539F\u6587\u6863" aria-hidden="true">#</a> \u539F\u6587\u6863</h2>',5),Ft={href:"http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html",target:"_blank",rel:"noopener noreferrer"},It=e("http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html");function Nt(Vt,Rt){const o=l("RouterLink"),n=l("OutboundLink");return i(),c(d,null,[_,t("p",null,[u,m,s(o,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_proxy_module.html#proxy_pass"},{default:r(()=>[g]),_:1}),b]),k,t("p",null,[x,s(o,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_hc_module.html"},{default:r(()=>[v]),_:1}),f,t("a",y,[w,s(n)]),E]),q,t("ul",null,[B,t("li",null,[A,z,t("blockquote",null,[t("p",null,[D,t("a",P,[S,s(n)]),$])])]),F]),t("p",null,[I,t("a",N,[V,s(n)]),R]),t("ul",null,[t("li",null,[C,L,t("p",null,[T,s(o,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_core_module.html#resolver"},{default:r(()=>[M]),_:1}),U,X,j,O,G])]),t("li",null,[H,t("p",null,[J,t("a",K,[Q,s(n)]),W,Y,Z]),t("p",null,[ee,te,se,t("a",ne,[ae,s(n)]),oe,re,le]),ce]),de]),ie,t("p",null,[pe,t("a",he,[_e,s(n)]),ue,s(o,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_api_module.html"},{default:r(()=>[me]),_:1}),ge]),t("blockquote",null,[t("p",null,[be,s(o,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_upstream_conf_module.html#upstream_conf"},{default:r(()=>[ke]),_:1}),xe])]),ve,t("p",null,[fe,s(o,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_api_module.html#stream_upstreams_stream_upstream_name_servers_"},{default:r(()=>[ye]),_:1}),we,Ee,qe]),t("blockquote",null,[t("p",null,[Be,s(o,{to:"/%E4%BB%8B%E7%BB%8D/%E6%8E%A7%E5%88%B6nginx.html#reconfiguration"},{default:r(()=>[Ae]),_:1}),ze,s(o,{to:"/%E4%BB%8B%E7%BB%8D/%E6%8E%A7%E5%88%B6nginx.html#upgrade"},{default:r(()=>[De]),_:1}),Pe])]),t("blockquote",null,[t("p",null,[Se,t("a",$e,[Fe,s(n)]),Ie])]),Ne,t("p",null,[Ve,t("a",Re,[Ce,s(n)]),Le]),t("p",null,[Te,Me,Ue,t("a",Xe,[je,s(n)]),Oe,Ge,He,t("a",Je,[Ke,s(n)]),Qe]),We,t("blockquote",null,[t("p",null,[Ye,t("a",Ze,[et,s(n)]),tt])]),st,t("p",null,[nt,t("a",at,[ot,s(n)]),rt,lt,ct,dt,it]),pt,t("blockquote",null,[t("p",null,[ht,_t,t("a",ut,[mt,s(n)]),gt])]),bt,t("p",null,[kt,xt,vt,s(o,{to:"/http/ngx_http_api_module.html#resolvers_"},{default:r(()=>[ft]),_:1}),yt]),t("blockquote",null,[t("p",null,[wt,t("a",Et,[qt,s(n)]),Bt])]),At,t("blockquote",null,[t("p",null,[zt,t("a",Dt,[Pt,s(n)]),St])]),$t,t("p",null,[t("a",Ft,[It,s(n)])])],64)}var Tt=p(h,[["render",Nt]]);export{Tt as default};
