import{r as l,c,a as s,b as t,w as n,F as r,d as o,e,o as d}from"./app.af3e3276.js";import{_ as p}from"./plugin-vue_export-helper.5a098b48.js";const _={},g=o(`<h1 id="ngx-stream-log-module" tabindex="-1"><a class="header-anchor" href="#ngx-stream-log-module" aria-hidden="true">#</a> ngx_stream_log_module</h1><ul><li><a href="#example_configuration">\u793A\u4F8B\u914D\u7F6E</a></li><li><a href="#directives">\u6307\u4EE4</a><ul><li><a href="#access_log">access_log</a></li><li><a href="#log_format">log_format</a></li><li><a href="#open_log_file_cache">open_log_file_cache</a></li></ul></li></ul><p><code>ngx_stream_log_module</code> \u6A21\u5757\uFF081.11.4\uFF09\u6309\u6307\u5B9A\u7684\u683C\u5F0F\u5199\u5165\u4F1A\u8BDD\u65E5\u5FD7\u3002</p><p><a id="example_configuration"></a></p><h2 id="\u793A\u4F8B\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B\u914D\u7F6E" aria-hidden="true">#</a> \u793A\u4F8B\u914D\u7F6E</h2><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">log_format</span> basic <span class="token string">&#39;<span class="token variable">$remote_addr</span> [<span class="token variable">$time_local]</span> &#39;</span>
                 <span class="token string">&#39;<span class="token variable">$protocol</span> <span class="token variable">$status</span> <span class="token variable">$bytes_sent</span> <span class="token variable">$bytes_received</span> &#39;</span>
                 <span class="token string">&#39;<span class="token variable">$session_time</span>&#39;</span></span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">access_log</span> /spool/logs/nginx-access.log basic buffer=32k</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><a id="directives"></a></p><h2 id="\u6307\u4EE4" tabindex="-1"><a class="header-anchor" href="#\u6307\u4EE4" aria-hidden="true">#</a> \u6307\u4EE4</h2><h3 id="access-log" tabindex="-1"><a class="header-anchor" href="#access-log" aria-hidden="true">#</a> access_log</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>access_log</strong> <code>path format [buffer=size] [gzip[=level]] [flush=time] [if=condition]</code>;<br><strong>access_log</strong> <code>off</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>access_log off;</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>stream\u3001server</td></tr></tbody></table>`,10),h=e("\u8BBE\u7F6E\u7F13\u51B2\u65E5\u5FD7\u5199\u5165\u7684\u8DEF\u5F84\u3001"),u=s("a",{href:"#log_format"},"\u683C\u5F0F",-1),m=e("\u548C\u914D\u7F6E\u3002\u53EF\u4EE5\u5728\u540C\u4E00\u7EA7\u522B\u6307\u5B9A\u591A\u4E2A\u65E5\u5FD7\u3002\u53EF\u901A\u8FC7\u5728\u7B2C\u4E00\u4E2A\u53C2\u6570\u4E2D\u6307\u5B9A "),b=s("code",null,"syslog:",-1),f=e(" \u524D\u7F00\u6765\u914D\u7F6E\u8BB0\u5F55\u5230 "),x=e("syslog"),k=e("\u3002\u7279\u6B8A\u503C "),v=s("code",null,"off",-1),y=e(" \u53D6\u6D88\u5F53\u524D\u7EA7\u522B\u7684\u6240\u6709 "),E=s("code",null,"access_log",-1),$=e(" \u6307\u4EE4\u3002"),B=o(`<p>\u5982\u679C\u4F7F\u7528 <code>buffer</code> \u6216 <code>gzip</code> \u53C2\u6570\uFF0C\u5219\u5C06\u7F13\u51B2 log \u7684\u5199\u5165\u3002</p><blockquote><p>\u7F13\u51B2\u533A\u5927\u5C0F\u4E0D\u5F97\u8D85\u8FC7\u78C1\u76D8\u6587\u4EF6\u7684\u539F\u5B50\u5199\u5165\u5927\u5C0F\u3002\u5BF9\u4E8E FreeBSD \u800C\u8A00\uFF0C\u8FD9\u4E2A\u5927\u5C0F\u662F\u65E0\u9650\u5236\u7684\u3002</p></blockquote><p>\u542F\u7528\u7F13\u51B2\u540E\uFF0C\u4EE5\u4E0B\u60C5\u51B5\u6570\u636E\u5C06\u5199\u5165\u6587\u4EF6\uFF1A</p><ul><li>\u5982\u679C\u4E0B\u4E00\u4E2A\u65E5\u5FD7\u884C\u4E0D\u80FD\u653E\u5165\u7F13\u51B2\u533A</li><li>\u5982\u679C\u7F13\u51B2\u7684\u6570\u636E\u65E9\u4E8E <code>flush</code> \u53C2\u6570\u6307\u5B9A\u7684\u6570\u636E</li><li>\u5F53 worker \u8FDB\u7A0B\u91CD\u65B0\u6253\u5F00\u65E5\u5FD7\u6587\u4EF6\u6216\u6B63\u5728\u5173\u95ED\u65F6</li></ul><p>\u5982\u679C\u4F7F\u7528 <code>gzip</code> \u53C2\u6570\uFF0C\u5C06\u5199\u5165\u6587\u4EF6\u4E4B\u524D\u5C06\u538B\u7F29\u7F13\u51B2\u7684\u6570\u636E\u3002\u538B\u7F29\u7EA7\u522B\u53EF\u4EE5\u8BBE\u7F6E\u4E3A 1\uFF08\u6700\u5FEB\uFF0C\u538B\u7F29\u7EA7\u522B\u4F4E\uFF09\u5230 9\uFF08\u6700\u6162\uFF0C\u538B\u7F29\u7EA7\u522B\u6700\u9AD8\uFF09\u4E4B\u95F4\u3002\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u7F13\u51B2\u533A\u5927\u5C0F\u7B49\u4E8E 64K \u5B57\u8282\uFF0C\u538B\u7F29\u7EA7\u522B\u8BBE\u7F6E\u4E3A 1\u3002\u7531\u4E8E\u6570\u636E\u662F\u4EE5\u539F\u5B50\u5757\u538B\u7F29\uFF0C\u56E0\u6B64\u65E5\u5FD7\u6587\u4EF6\u53EF\u4EE5\u968F\u65F6\u901A\u8FC7 <code>zcat</code> \u89E3\u538B\u7F29\u6216\u8BFB\u53D6\u3002</p><p>\u793A\u4F8B\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">access_log</span> /path/to/log.gz basic gzip flush=5m</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>\u8981\u4F7F gzip \u538B\u7F29\u8D77\u4F5C\u7528\uFF0C\u5FC5\u987B\u5728\u6784\u5EFA nginx \u4F7F\u7528 zlib \u5E93\u3002</p></blockquote><p>\u6587\u4EF6\u8DEF\u5F84\u53EF\u4EE5\u5305\u542B\u53D8\u91CF\uFF0C\u4F46\u662F\u8FD9\u6837\u7684\u65E5\u5FD7\u6709\u4E00\u4E9B\u7EA6\u675F\uFF1A</p>`,9),q=e("\u88AB worker \u8FDB\u7A0B\u4F7F\u7528\u51ED\u636E\u7684"),w=e("\u7528\u6237"),z=e("\u5E94\u5177\u6709\u5728\u5177\u6709\u6B64\u7C7B\u65E5\u5FD7\u7684\u76EE\u5F55\u4E2D\u521B\u5EFA\u6587\u4EF6\u7684\u6743\u9650"),A=s("li",null,"\u7F13\u51B2\u5199\u5165\u5C06\u4E0D\u8D77\u4F5C\u7528",-1),F=e("\u6BCF\u4E2A\u65E5\u5FD7\u5199\u5165\u90FD\u4F1A\u6253\u5F00\u548C\u5173\u95ED\u6587\u4EF6\u3002\u4F46\u662F\uFF0C\u7531\u4E8E\u9891\u7E41\u4F7F\u7528\u7684\u6587\u4EF6\u7684\u63CF\u8FF0\u7B26\u53EF\u4EE5\u5B58\u50A8\u5728"),D=e("\u7F13\u5B58"),N=e("\u4E2D\uFF0C\u56E0\u6B64\u53EF\u4EE5\u5728 "),L=e("open_log_file_cache"),j=e(" \u6307\u4EE4\u7684 "),V=s("code",null,"valid",-1),R=e(" \u53C2\u6570\u6307\u5B9A\u7684\u65F6\u95F4\u5185\u7EE7\u7EED\u5199\u5165\u65E7\u6587\u4EF6"),C=o(`<p><code>if</code> \u53C2\u6570\u542F\u7528\u6761\u4EF6\u65E5\u5FD7\u3002\u5982\u679C <code>condition</code> \u8BA1\u503C\u4E3A 0 \u6216\u7A7A\u5B57\u7B26\u4E32\uFF0C\u5219\u4E0D\u4F1A\u8BB0\u5F55\u4F1A\u8BDD\u3002</p><h3 id="log-format" tabindex="-1"><a class="header-anchor" href="#log-format" aria-hidden="true">#</a> log_format</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>log_format</strong> <code>name [escape=default|json|none] string ...</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>\u2014\u2014</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>stream</td></tr></tbody></table><p>\u6307\u5B9A\u65E5\u5FD7\u683C\u5F0F\uFF0C\u4F8B\u5982\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">log_format</span> proxy <span class="token string">&#39;<span class="token variable">$remote_addr</span> [<span class="token variable">$time_local]</span> &#39;</span>
                 <span class="token string">&#39;<span class="token variable">$protocol</span> <span class="token variable">$status</span> <span class="token variable">$bytes_sent</span> <span class="token variable">$bytes_received</span> &#39;</span>
                 <span class="token string">&#39;<span class="token variable">$session_time</span> &quot;<span class="token variable">$upstream_addr</span>&quot; &#39;</span>
                 <span class="token string">&#39;&quot;<span class="token variable">$upstream_bytes_sent</span>&quot; &quot;<span class="token variable">$upstream_bytes_received</span>&quot; &quot;<span class="token variable">$upstream_connect_time</span>&quot;&#39;</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>escape</code> \u53C2\u6570\uFF081.11.8\uFF09\u5141\u8BB8\u5728\u53D8\u91CF\u4E2D\u8BBE\u7F6E\u8F6C\u4E49\u7684 <code>json</code> \u6216 <code>default</code> \u5B57\u7B26\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u4F7F\u7528 <code>default</code> \u8F6C\u4E49\u3002 <code>none</code> \u53C2\u6570\uFF081.13.10\uFF09\u7981\u7528\u8F6C\u4E49\u3002</p><h3 id="open-log-file-cache" tabindex="-1"><a class="header-anchor" href="#open-log-file-cache" aria-hidden="true">#</a> open_log_file_cache</h3><table><thead><tr><th style="text-align:right;">-</th><th>\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>\u8BED\u6CD5</strong></td><td><strong>open_log_file_cache</strong> <code>max=N [inactive=time] [min_uses=N] [valid=time]</code>;<br><strong>open_log_file_cache</strong> <code>off</code>;</td></tr><tr><td style="text-align:right;"><strong>\u9ED8\u8BA4</strong></td><td>open_log_file_cache off;</td></tr><tr><td style="text-align:right;"><strong>\u4E0A\u4E0B\u6587</strong></td><td>stream\u3001server</td></tr></tbody></table><p>\u5B9A\u4E49\u4E00\u4E2A\u7F13\u5B58\uFF0C\u7528\u4E8E\u5B58\u50A8\u540D\u79F0\u4E2D\u5305\u542B\u53D8\u91CF\u7684\u5E38\u7528\u65E5\u5FD7\u7684\u6587\u4EF6\u63CF\u8FF0\u7B26\u3002\u8BE5\u6307\u4EE4\u6709\u4EE5\u4E0B\u53C2\u6570\uFF1A</p><ul><li><p><code>max</code></p><p>\u8BBE\u7F6E\u7F13\u5B58\u4E2D\u7684\u6700\u5927\u63CF\u8FF0\u7B26\u6570\uFF0C\u5982\u679C\u7F13\u5B58\u53D8\u6EE1\uFF0C\u5219\u6700\u8FD1\u6700\u5C11\u4F7F\u7528\uFF08LRU\uFF09\u7684\u63CF\u8FF0\u7B26\u5C06\u88AB\u5173\u95ED</p></li><li><p><code>inactive</code></p><p>\u5982\u679C\u5728\u6B64\u671F\u95F4\u6CA1\u6709\u53D1\u751F\u8BBF\u95EE\uFF0C\u5219\u8BBE\u7F6E\u5173\u95ED\u7F13\u5B58\u63CF\u8FF0\u7B26\u7684\u65F6\u95F4\u3002\u9ED8\u8BA4\u4E3A 10 \u79D2</p></li><li><p><code>min_uses</code></p><p>\u8BBE\u7F6E\u5728 <code>inactive</code> \u53C2\u6570\u5B9A\u4E49\u7684\u65F6\u95F4\u5185\u6587\u4EF6\u4F7F\u7528\u7684\u6700\u5C0F\u6570\u91CF\uFF0C\u4F7F\u63CF\u8FF0\u7B26\u5728\u7F13\u5B58\u4E2D\u4FDD\u6301\u6253\u5F00\u72B6\u6001\u3002\u9ED8\u8BA4\u4E3A 1</p></li><li><p><code>valid</code></p><p>\u8BBE\u7F6E\u68C0\u67E5\u540C\u540D\u6587\u4EF6\u662F\u5426\u4ECD\u7136\u5B58\u5728\u7684\u65F6\u95F4\u3002\u9ED8\u8BA4\u4E3A 60 \u79D2</p></li><li><p><code>off</code></p><p>\u7981\u7528\u7F13\u5B58</p></li></ul><p>\u7528\u6CD5\u793A\u4F8B\uFF1A</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">open_log_file_cache</span> max=1000 inactive=20s valid=1m min_uses=2</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="\u539F\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#\u539F\u6587\u6863" aria-hidden="true">#</a> \u539F\u6587\u6863</h2>`,13),O={href:"http://nginx.org/en/docs/stream/ngx_stream_log_module.html",target:"_blank",rel:"noopener noreferrer"},S=e("http://nginx.org/en/docs/stream/ngx_stream_log_module.html");function K(T,U){const a=l("RouterLink"),i=l("OutboundLink");return d(),c(r,null,[g,s("p",null,[h,u,m,b,f,t(a,{to:"/%E4%BB%8B%E7%BB%8D/%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E5%88%B0syslog.html"},{default:n(()=>[x]),_:1}),k,v,y,E,$]),B,s("ul",null,[s("li",null,[q,t(a,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#user"},{default:n(()=>[w]),_:1}),z]),A,s("li",null,[F,t(a,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_log_module.html#open_log_file_cache"},{default:n(()=>[D]),_:1}),N,t(a,{to:"/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_log_module.html#open_log_file_cache"},{default:n(()=>[L]),_:1}),j,V,R])]),C,s("p",null,[s("a",O,[S,t(i)])])],64)}var I=p(_,[["render",K]]);export{I as default};
