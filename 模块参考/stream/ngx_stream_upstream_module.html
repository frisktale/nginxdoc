<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>ngx_stream_upstream_module | Nginx中文文档</title><meta name="description" content="不是很靠谱的翻译">
    <link rel="modulepreload" href="/nginxdoc/assets/app.9c72f7b5.js"><link rel="modulepreload" href="/nginxdoc/assets/ngx_stream_upstream_module.html.64fddff4.js"><link rel="modulepreload" href="/nginxdoc/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/nginxdoc/assets/ngx_stream_upstream_module.html.03620f0e.js">
    <link rel="stylesheet" href="/nginxdoc/assets/style.49723153.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/nginxdoc/" class=""><!----><span class="site-name">Nginx中文文档</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">ngx_stream_upstream_module</p><ul class=""><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#示例配置" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="示例配置"><!--[--><!--]--> 示例配置 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#指令" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="指令"><!--[--><!--]--> 指令 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#upstream" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="upstream"><!--[--><!--]--> upstream <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#server" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="server"><!--[--><!--]--> server <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#zone" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="zone"><!--[--><!--]--> zone <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#state" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="state"><!--[--><!--]--> state <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#hash" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="hash"><!--[--><!--]--> hash <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#least-conn" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="least_conn"><!--[--><!--]--> least_conn <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#least-time" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="least_time"><!--[--><!--]--> least_time <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#random" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="random"><!--[--><!--]--> random <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#resolver" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="resolver"><!--[--><!--]--> resolver <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#resolver-timeout" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="resolver_timeout"><!--[--><!--]--> resolver_timeout <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#内部变量" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="内部变量"><!--[--><!--]--> 内部变量 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_module.html#原文档" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="原文档"><!--[--><!--]--> 原文档 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="ngx-stream-upstream-module" tabindex="-1"><a class="header-anchor" href="#ngx-stream-upstream-module" aria-hidden="true">#</a> ngx_stream_upstream_module</h1><ul><li><a href="#example_configuration">示例配置</a></li><li><a href="#directives">指令</a><ul><li><a href="#upstream">upstream</a></li><li><a href="#server">server</a></li><li><a href="#zone">zone</a></li><li><a href="#state">state</a></li><li><a href="#hash">hash</a></li><li><a href="#least_conn">least_conn</a></li><li><a href="#least_time">least_time</a></li><li><a href="#random">random</a></li><li><a href="#resolver">resolver</a></li><li><a href="#resolver_timeout">resolver_timeout</a></li></ul></li><li><a href="#embedded_variables">内部变量</a></li></ul><p><code>ngx_stream_upstream_module</code> 模块（1.9.0）用于定义可以由 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_proxy_module.html#proxy_pass" class="">proxy_pass</a> 指令引用的服务器组。</p><p><a id="example_configuration"></a></p><h2 id="示例配置" tabindex="-1"><a class="header-anchor" href="#示例配置" aria-hidden="true">#</a> 示例配置</h2><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$remote_addr</span> consistent</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backend1.example.com:12345  weight=5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend2.example.com:12345</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> unix:/tmp/backend3</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backup1.example.com:12345   backup</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backup2.example.com:12345   backup</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">12346</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> backend</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>拥有定期运行<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_upstream_hc_module.html" class="">健康检查</a>的动态可配置组为<a href="http://nginx.com/products/?_ga=2.130645319.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver</span> 10.0.0.1</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">upstream</span> dynamic</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">zone</span> upstream_dynamic <span class="token number">64k</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backend1.example.com:12345 weight=5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend2.example.com:12345 fail_timeout=5s slow_start=30s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 192.0.2.1:12345            max_fails=3</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend3.example.com:12345 resolve</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend4.example.com       service=http resolve</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backup1.example.com:12345  backup</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backup2.example.com:12345  backup</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">12346</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> dynamic</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">health_check</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><a id="directives"></a></p><h2 id="指令" tabindex="-1"><a class="header-anchor" href="#指令" aria-hidden="true">#</a> 指令</h2><h3 id="upstream" tabindex="-1"><a class="header-anchor" href="#upstream" aria-hidden="true">#</a> upstream</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>upstream</strong> <code>name { ... }</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>stream</td></tr></tbody></table><p>定义一组服务器。服务器可以在不同的端口上监听。此外，可以将监听 TCP 和 UNIX 域套接字的服务器混合使用。</p><p>示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> backend1.example.com:12345 weight=5</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:12345            max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> unix:/tmp/backend2</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> backend3.example.com:12345 resolve</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">server</span> backup1.example.com:12345  backup</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>默认使用加权轮询均衡算法在服务器间分配连接。在上面的示例中，每 7 个连接将如下分配：5 个连接转到 <code>backend1.example.com:12345</code>，一个连接到第二个和第三个服务器。如果在与服务器通信期间发生错误，则连接将被传递到下一个服务器，依此类推，直到尝试完所有正常运行的服务器为止。如果与所有服务器的通信都失败，则连接将关闭。</p><h3 id="server" tabindex="-1"><a class="header-anchor" href="#server" aria-hidden="true">#</a> server</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>server</strong> <code>address [parameters]</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr></tbody></table><p>定义服务器的地址（<code>address</code>）和其他参数。该地址可以指定为带有端口的域名或 IP 地址，也可以指定前缀为 <code>unix</code> 的 UNIX 域套接字路径。解析为多个 IP 地址的域名一次定义了多个服务器。</p><p>可以定义以下参数：</p><ul><li><p><code>weight=number</code></p><p>设置服务器的权重，默认情况下为 1。</p></li><li><p><code>max_conns=number</code></p><p>限制到被代理服务器的最大同时连接数（1.11.5）。默认值为零，表示没有限制。如果服务器组未驻留在<a href="#zone">共享内存</a>中，则此限制在每个 worker 进程中均有效。</p><blockquote><p>在 1.11.5 版本之前，此参数作为<a href="http://nginx.com/products/?_ga=2.208745946.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分。</p></blockquote></li><li><p><code>max_fails=number</code></p><p>设置在 <code>fail_timeout</code> 参数设置的时间内与服务器通信的失败尝试次数，以便认定服务器在 <code>fail_timeout</code> 参数设置的时间内不可用。默认情况下，失败尝试的次数设置为 1。零值将禁用尝试记录。在这里，当与服务器正在建立连接中，失败尝试将是一个错误或超时。</p></li><li><p><code>fail_timeout=time</code></p><p>设置</p><ul><li>在时间范围内与服务器通信的失败尝试达到指定次数，应将服务器视为不可用</li><li>服务器被视为不可用的时长</li></ul><p>默认情况下，该参数设置为 10 秒。</p></li><li><p><code>backup</code></p><p>将服务器标记为备用服务器。当主服务器不可用时，连接将传递到备用服务器。</p><blockquote><p>该参数不能与 <a href="#hash">hash</a> 和 <a href="#random">random</a> 负载均衡算法一起使用。</p></blockquote></li><li><p><code>down</code></p><p>将服务器标记为永久不可用。</p></li></ul><p>此外，以下参数作为<a href="http://nginx.com/products/?_ga=2.134173126.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分提供：</p><ul><li><p><code>resolve</code></p><p>监视与服务器域名相对应的 IP 地址的更改，并自动修改 upstream 配置，而无需重新启动 nginx。服务器组必须驻留在<a href="#zone">共享内存</a>中。</p><p>为了使此参数生效，必须在 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/stream/ngx_stream_core_module.html#resolver" class="">stream</a> 块或相应的 <a href="#resolver">upstream</a> 块中指定 <code>resolver</code> 指令。</p></li><li><p><code>service=name</code></p><p>启用 DNS <a href="https://tools.ietf.org/html/rfc2782" target="_blank" rel="noopener noreferrer">SRV<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 记录的解析并设置服务名称（1.9.13）。为了使此参数生效，必须为服务器指定 <a href="#resolve">resolve</a> 参数，并指定不带端口号的主机名。</p><p>如果服务名称不包含点（<code>.</code>），则构造符合 <a href="https://tools.ietf.org/html/rfc2782" target="_blank" rel="noopener noreferrer">RFC<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 的名称，并将 TCP 协议添加到服务前缀。例如，要查找 <code>_http._tcp.backend.example.com</code> SRV 记录，必须指定指令：</p><p>如果服务名称包含一个或多个点（<code>.</code>），则通过将服务前缀和服务器名称结合在一起来构造名称。例如，要查找 <code>_http._tcp.backend.example.com</code> 和 <code>server1.backend.example.com</code> SRV 记录，必须指定指令：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span> backend.example.com service=_http._tcp resolve</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">server</span> example.com service=server1.backend resolve</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>最高优先级的 SRV 记录（具有相同的最低优先级值的记录）被解析为主服务器，其余的 SRV 记录被解析为备用服务器。如果为服务器指定了 <a href="#backup">backup</a> 参数，则将高优先级 SRV 记录解析为备用服务器，其余的 SRV 记录将被忽略。</p></li><li><p><code>slow_start=time</code></p><p>设置当服务器从非健康状态转为健康状态或一段时间<a href="#fail_timeout">不可用</a>后转为可用状态，服务器将其权重从 0 恢复到原值的时间（<code>time</code>）。默认值为零，即禁用此功能。</p><blockquote><p>该参数不能与 <a href="#hash">hash</a> 和 <a href="#random">random</a> 负载均衡算法一起使用。</p></blockquote></li></ul><p>如果组中只有一台服务器，则将忽略 <code>max_fails</code>、<code>fail_timeout</code> 和 <code>slow_start</code> 参数，这样的服务器将永远不会被视为不可用。</p><h3 id="zone" tabindex="-1"><a class="header-anchor" href="#zone" aria-hidden="true">#</a> zone</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>zone</strong> <code>name [size]</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr></tbody></table><p>定义共享内存区域的名称（<code>name</code>）和大小（<code>size</code>），以存储 worker 进程之间共享的组配置和运行时状态。多个组可共享同一区域。在这种情况下，仅指定一次大小就足够了。</p><p>另外，在<a href="http://nginx.com/products/?_ga=2.171473384.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分中，此类组允许更改组成员身份或修改特定服务器的设置，而无需重新启动 nginx。可通过 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_api_module.html" class="">API</a> 模块（1.13.3）访问该配置。</p><blockquote><p>在 1.13.3 版本之前，只能访问特殊的 location 来通过 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_upstream_conf_module.html#upstream_conf" class="">upstream_conf</a> 处理。</p></blockquote><h3 id="state" tabindex="-1"><a class="header-anchor" href="#state" aria-hidden="true">#</a> state</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>state</strong> <code>file</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr><tr><td style="text-align:right;"><strong>提示</strong></td><td>该指令在 1.9.7 版本中出现</td></tr></tbody></table><p>指定一个文件用于保存动态可配置组的状态。</p><p>示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">state</span> /var/lib/nginx/state/servers.conf</span><span class="token punctuation">;</span> <span class="token comment"># path for Linux</span>
<span class="token directive"><span class="token keyword">state</span> /var/db/nginx/state/servers.conf</span><span class="token punctuation">;</span>  <span class="token comment"># path for FreeBSD</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>当前状态仅限于带有参数的服务器列表。解析配置时会读取该文件，并且每次更改 upstream 配置时都会<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_api_module.html#stream_upstreams_stream_upstream_name_servers_" class="">更新</a>该文件。应避免直接更改文件内容。该指令不能与 <a href="#server">server</a> 指令一起使用。</p><blockquote><p>在<a href="/nginxdoc/%E4%BB%8B%E7%BB%8D/%E6%8E%A7%E5%88%B6nginx.html#reconfiguration" class="">配置重新加载</a>或<a href="/nginxdoc/%E4%BB%8B%E7%BB%8D/%E6%8E%A7%E5%88%B6nginx.html#upgrade" class="">二进制升级</a>期间所做的更改可能会丢失。</p></blockquote><blockquote><p>该指令为<a href="http://nginx.com/products/?_ga=2.128922308.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分。</p></blockquote><h3 id="hash" tabindex="-1"><a class="header-anchor" href="#hash" aria-hidden="true">#</a> hash</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>hash</strong> <code>key [consistent]</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr></tbody></table><p>指定服务器组的负载均衡算法，在该服务器组中，客户端——服务器的映射基于哈希键值（key/value）。key 可以包含文本、变量及其组合（1.11.2）。 用法示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>请注意，从组中添加或删除服务器可能会导致大量 key 重新映射到其他服务器。该方法与 <a href="https://metacpan.org/pod/Cache::Memcached" target="_blank" rel="noopener noreferrer">Cache::Memcached<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> Perl 库兼容。</p><p>如果指定了 <code>consistent</code> 参数，则将使用 <a href="https://www.metabrew.com/article/libketama-consistent-hashing-algo-memcached-clients" target="_blank" rel="noopener noreferrer">ketama<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 一致性哈希算法。该方法可确保在将服务器添加到组中或从组中删除服务器时，只有很少的 key 被重新映射到不同的服务器。这有助于缓存服务器实现更高的缓存命中率。该方法与 <code>ketama_points</code> 参数设置为 160 的 <a href="https://metacpan.org/pod/Cache::Memcached::Fast" target="_blank" rel="noopener noreferrer">Cache::Memcached::Fast<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> Perl 库兼容。</p><h3 id="least-conn" tabindex="-1"><a class="header-anchor" href="#least-conn" aria-hidden="true">#</a> least_conn</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>least_conn</strong>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr></tbody></table><p>指定组使用的负载均衡算法，其将连接传递到活动连接数最少的服务器，同时要考虑服务器的权重。如果有多个这样的服务器，则依次使用加权轮询均衡算法进行尝试。</p><h3 id="least-time" tabindex="-1"><a class="header-anchor" href="#least-time" aria-hidden="true">#</a> least_time</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>least_time</strong> <code>connect</code> | <code>first_byte</code> | <code>last_byte</code> <code>[inflight]</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr></tbody></table><p>指定组应使用的负载均衡算法，其将连接传递到平均时间最少且活动连接数最少的服务器，同时考虑服务器的权重。如果有多个这样的服务器，则依次使用加权轮询均衡算法进行尝试。</p><p>如果指定了 <code>connect</code> 参数，则使用<a href="#var_upstream_connect_time">连接</a>到 upstream 服务器的时间。如果指定了 <code>first_byte</code> 变量，则使用接收数据的<a href="#var_upstream_first_byte_time">首字节</a>的时间。如果指定了 <code>last_byte</code>，则使用接收数据<a href="#var_upstream_session_time">尾字节</a>的时间。如果指定了 <code>inflight</code> 参数（1.11.6），还将考虑不完整连接。</p><blockquote><p>在 1.11.6 版本之前，默认情况下会考虑不完整的连接。</p></blockquote><blockquote><p>该指令作为<a href="http://nginx.com/products/?_ga=2.162551156.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分。</p></blockquote><h3 id="random" tabindex="-1"><a class="header-anchor" href="#random" aria-hidden="true">#</a> random</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>random</strong> <code>[two [method]]</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr><tr><td style="text-align:right;"><strong>提示</strong></td><td>该指令在 1.15.1 版本中出现</td></tr></tbody></table><p>指定组应使用的负载均衡算法，其将连接传递到随机选择的服务器，同时要考虑服务器的权重。</p><p>可选的两个参数指示 nginx 随机选择<a href="https://homes.cs.washington.edu/~karlin/papers/balls.pdf" target="_blank" rel="noopener noreferrer">两个<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>服务器，然后使用指定的算法（<code>method</code>）选择一个服务器。默认方法是 <code>minimum_conn</code>，它将连接传递到活动连接数最少的服务器。</p><p><code>minimum_time</code> 算法将连接传递到平均时间最少且活动连接数最少的服务器。如果指定了 <code>least_time=connect</code> 参数，则使用<a href="#var_upstream_connect_time">连接</a>到 upstream 服务器的时间。如果指定了 <code>least_time=first_byte</code> 参数，则使用接收数据的<a href="#var_upstream_first_byte_time">首字节</a>的时间。如果指定了 <code>least_time=last_byte</code>，如果指定了 <code>last_byte</code>，则使用接收数据<a href="#var_upstream_session_time">尾字节</a>的时间。</p><blockquote><p><code>least_time</code> 算法是<a href="http://nginx.com/products/?_ga=2.200372710.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分。</p></blockquote><h3 id="resolver" tabindex="-1"><a class="header-anchor" href="#resolver" aria-hidden="true">#</a> resolver</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>resolver</strong> <code>address ... [valid=time] [ipv6=on|off] [status_zone=zone]</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>——</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr><tr><td style="text-align:right;"><strong>提示</strong></td><td>该指令在 1.17.5 版本中出现</td></tr></tbody></table><p>配置用于将 upstream 服务器的名称解析为地址的名称服务器，例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver</span> 127.0.0.1 [::1]:5353</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>可以将地址指定为域名或 IP 地址，配置一个可选端口。如果未指定端口，则使用 53 端口。以轮询算法查找名称服务器。</p><p>默认情况下，nginx 在解析时将同时查找 IPv4 和 IPv6 地址。如果不需要查找 IPv6 地址，则可以指定 <code>ipv6=off</code> 参数。</p><p>默认情况下，nginx 使用响应的 TTL 值缓存回复。可选的 <code>valid</code> 参数覆盖默认行为：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver</span> 127.0.0.1 [::1]:5353 valid=30s</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>为防止 DNS 欺骗，建议在一个受到保护的可信本地网络中配置 DNS 服务器。</p></blockquote><p>可选的 <code>status_zone</code> 参数启用对指定区域中请求和响应的 DNS 服务器统计信息的<a href="/nginxdoc/http/ngx_http_api_module.html#resolvers_" class="">收集</a>。</p><blockquote><p>该指令为<a href="http://nginx.com/products/?_ga=2.175591914.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分。</p></blockquote><h3 id="resolver-timeout" tabindex="-1"><a class="header-anchor" href="#resolver-timeout" aria-hidden="true">#</a> resolver_timeout</h3><table><thead><tr><th style="text-align:right;">-</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:right;"><strong>语法</strong></td><td><strong>resolver_timeout</strong> <code>time</code>;</td></tr><tr><td style="text-align:right;"><strong>默认</strong></td><td>resolver_timeout 30s;</td></tr><tr><td style="text-align:right;"><strong>上下文</strong></td><td>upstream</td></tr><tr><td style="text-align:right;"><strong>提示</strong></td><td>该指令在 1.17.5 版本中出现</td></tr></tbody></table><p>为名称解析设置一个超时时间，例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver_timeout</span> <span class="token number">5s</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>该指令为<a href="http://nginx.com/products/?_ga=2.133192262.99786210.1588592638-1615340879.1588592638" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>部分。</p></blockquote><p><a id="embedded_variables"></a></p><h2 id="内部变量" tabindex="-1"><a class="header-anchor" href="#内部变量" aria-hidden="true">#</a> 内部变量</h2><p><code>ngx_stream_upstream_module</code> 模块支持以下内部变量：</p><ul><li><p><code>$upstream_addr</code></p><p>保留 IP 地址和端口或 upstream 服务器的 UNIX 域套接字（1.11.4）路径。如果在代理过程中联系了多个服务器，则它们的地址用逗号分隔，例如 <code>192.168.1.1:12345, 192.168.1.2:12345, unix:/tmp/sock</code>。如果无法选择服务器，则该变量将保留服务器组的名称。</p></li><li><p><code>$upstream_bytes_received</code></p><p>从 upstream 服务器收到的字节数（1.11.4）。来自多个连接的值使用逗号分隔，参考 <code>$upstream_addr</code> 变量中的地址。</p></li><li><p><code>$upstream_bytes_sent</code></p><p>发送到 upstream 服务器的字节数（1.11.4）。来自多个连接的值使用逗号分隔，参考 <code>$upstream_addr</code> 变量中的地址。</p></li><li><p><code>$upstream_connect_time</code></p><p>连接 upstream 服务器的时间（1.11.4），时间以毫秒为单位，以秒为单位。多个连接的时间用逗号分隔，参考 <code>$upstream_addr</code> 变量中的地址。</p></li><li><p><code>$upstream_first_byte_time</code></p><p>接收数据的第一个字节的时间（1.11.4），时间以毫秒为单位，以秒为单位。多个连接的时间用逗号分隔，参考 <code>$upstream_addr</code> 变量中的地址。</p></li><li><p><code>$upstream_session_time</code></p><p>会话持续时间，以毫秒为单位，以毫秒为单位（1.11.4）。多个连接的时间用逗号分隔，参考 <code>$upstream_addr</code> 变量中的地址。</p></li></ul><h2 id="原文档" tabindex="-1"><a class="header-anchor" href="#原文档" aria-hidden="true">#</a> 原文档</h2><p><a href="http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">10/19/2021, 2:05:51 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: frisktale@live.com">frisktale</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/nginxdoc/assets/app.9c72f7b5.js" defer></script>
  </body>
</html>
