<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>ngx_http_core_module | Hello VitePress</title><meta name="description" content="Just playing around.">
    <link rel="modulepreload" href="/nginxdoc/assets/app.245ece3f.js"><link rel="modulepreload" href="/nginxdoc/assets/ngx_http_core_module.html.448733ce.js"><link rel="modulepreload" href="/nginxdoc/assets/plugin-vue_export-helper.5a098b48.js"><link rel="modulepreload" href="/nginxdoc/assets/ngx_http_core_module.html.e3408b42.js">
    <link rel="stylesheet" href="/nginxdoc/assets/style.49723153.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/nginxdoc/" class=""><!----><span class="site-name">Hello VitePress</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">ngx_http_core_module</p><ul class=""><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#指令" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="指令"><!--[--><!--]--> 指令 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#absolute-redirect" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="absolute_redirect"><!--[--><!--]--> absolute_redirect <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#aio" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="aio"><!--[--><!--]--> aio <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#aio-write" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="aio_write"><!--[--><!--]--> aio_write <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#alias" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="alias"><!--[--><!--]--> alias <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#chunked-transfer-encoding" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="chunked_transfer_encoding"><!--[--><!--]--> chunked_transfer_encoding <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#client-body-buffer-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="client_body_buffer_size"><!--[--><!--]--> client_body_buffer_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#client-body-in-file-only" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="client_body_in_file_only"><!--[--><!--]--> client_body_in_file_only <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#client-body-in-single-buffer" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="client_body_in_single_buffer"><!--[--><!--]--> client_body_in_single_buffer <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#client-body-temp-path" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="client_body_temp_path"><!--[--><!--]--> client_body_temp_path <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#client-body-timeout" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="client_body_timeout"><!--[--><!--]--> client_body_timeout <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#client-header-buffer-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="client_header_buffer_size"><!--[--><!--]--> client_header_buffer_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#client-header-timeout" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="client_header_timeout"><!--[--><!--]--> client_header_timeout <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#client-max-body-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="client_max_body_size"><!--[--><!--]--> client_max_body_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#connection-pool-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="connection_pool_size"><!--[--><!--]--> connection_pool_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#default-type" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="default_type"><!--[--><!--]--> default_type <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#directio" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="directio"><!--[--><!--]--> directio <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#directio-alignment" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="directio_alignment"><!--[--><!--]--> directio_alignment <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#disable-symlinks" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="disable_symlinks"><!--[--><!--]--> disable_symlinks <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#error-page" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="error_page"><!--[--><!--]--> error_page <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#etag" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="etag"><!--[--><!--]--> etag <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#http" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="http"><!--[--><!--]--> http <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#if-modified-since" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="if_modified_since"><!--[--><!--]--> if_modified_since <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#ignore-invalid-headers" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="ignore_invalid_headers"><!--[--><!--]--> ignore_invalid_headers <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#internal" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="internal"><!--[--><!--]--> internal <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#keepalive-disable" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="keepalive_disable"><!--[--><!--]--> keepalive_disable <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#keepalive-requests" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="keepalive_requests"><!--[--><!--]--> keepalive_requests <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#keepalive-timeout" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="keepalive_timeout"><!--[--><!--]--> keepalive_timeout <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#large-client-header-buffers" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="large_client_header_buffers"><!--[--><!--]--> large_client_header_buffers <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#limit-except" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="limit_except"><!--[--><!--]--> limit_except <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#limit-rate" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="limit_rate"><!--[--><!--]--> limit_rate <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#lingering-time" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="lingering_time"><!--[--><!--]--> lingering_time <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#lingering-timeout" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="lingering_timeout"><!--[--><!--]--> lingering_timeout <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#listen" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="listen"><!--[--><!--]--> listen <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#location" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="location"><!--[--><!--]--> location <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#log-not-found" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="log_not_found"><!--[--><!--]--> log_not_found <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#log-subrequest" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="log_subrequest"><!--[--><!--]--> log_subrequest <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#max-ranges" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="max_ranges"><!--[--><!--]--> max_ranges <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#merge-slashes" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="merge_slashes"><!--[--><!--]--> merge_slashes <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#msie-padding" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="msie_padding"><!--[--><!--]--> msie_padding <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#msie-refresh" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="msie_refresh"><!--[--><!--]--> msie_refresh <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#open-file-cache" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="open_file_cache"><!--[--><!--]--> open_file_cache <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#open-file-cache-errors" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="open_file_cache_errors"><!--[--><!--]--> open_file_cache_errors <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#open-file-cache-min-uses" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="open_file_cache_min_uses"><!--[--><!--]--> open_file_cache_min_uses <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#open-file-cache-valid" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="open_file_cache_valid"><!--[--><!--]--> open_file_cache_valid <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#output-buffers" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="output_buffers"><!--[--><!--]--> output_buffers <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#port-in-redirect" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="port_in_redirect"><!--[--><!--]--> port_in_redirect <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#postpone-output" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="postpone_output"><!--[--><!--]--> postpone_output <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#read-ahead" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="read_ahead"><!--[--><!--]--> read_ahead <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#recursive-error-pages" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="recursive_error_pages"><!--[--><!--]--> recursive_error_pages <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#request-pool-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="request_pool_size"><!--[--><!--]--> request_pool_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#reset-timedout-connection" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="reset_timedout_connection"><!--[--><!--]--> reset_timedout_connection <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#resolver" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="resolver"><!--[--><!--]--> resolver <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#satisfy" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="satisfy"><!--[--><!--]--> satisfy <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#send-lowat" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="send_lowat"><!--[--><!--]--> send_lowat <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#send-timeout" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="send_timeout"><!--[--><!--]--> send_timeout <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#sendfile" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="sendfile"><!--[--><!--]--> sendfile <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#sendfile-max-chunk" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="sendfile_max_chunk"><!--[--><!--]--> sendfile_max_chunk <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#server" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="server"><!--[--><!--]--> server <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#server-name" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="server_name"><!--[--><!--]--> server_name <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#server-name-in-redirect" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="server_name_in_redirect"><!--[--><!--]--> server_name_in_redirect <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#server-names-hash-bucket-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="server_names_hash_bucket_size"><!--[--><!--]--> server_names_hash_bucket_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#server-names-hash-max-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="server_names_hash_max_size"><!--[--><!--]--> server_names_hash_max_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#server-tokens" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="server_tokens"><!--[--><!--]--> server_tokens <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#tcp-nodelay" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="tcp_nodelay"><!--[--><!--]--> tcp_nodelay <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#tcp-nopush" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="tcp_nopush"><!--[--><!--]--> tcp_nopush <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#try-files" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="try_files"><!--[--><!--]--> try_files <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#types-hash-bucket-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="types_hash_bucket_size"><!--[--><!--]--> types_hash_bucket_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#types-hash-max-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="types_hash_max_size"><!--[--><!--]--> types_hash_max_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#underscores-in-headers" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="underscores_in_headers"><!--[--><!--]--> underscores_in_headers <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#variables-hash-bucket-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="variables_hash_bucket_size"><!--[--><!--]--> variables_hash_bucket_size <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#variables-hash-max-size" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="variables_hash_max_size"><!--[--><!--]--> variables_hash_max_size <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#内嵌变量" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="内嵌变量"><!--[--><!--]--> 内嵌变量 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#原文档" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="原文档"><!--[--><!--]--> 原文档 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="ngx-http-core-module" tabindex="-1"><a class="header-anchor" href="#ngx-http-core-module" aria-hidden="true">#</a> ngx_http_core_module</h1><ul><li><a href="#directives">指令</a><ul><li><a href="#absolute_redirect">absolute_redirect</a></li><li><a href="#aio">aio</a></li><li><a href="#aio_write">aio_write</a></li><li><a href="#alias">alias</a></li><li><a href="#chunked_transfer_encoding">chunked_transfer_encoding</a></li><li><a href="#client_body_buffer_size">client_body_buffer_size</a></li><li><a href="#client_body_in_file_only">client_body_in_file_only</a></li><li><a href="#client_body_in_single_buffer">client_body_in_single_buffer</a></li><li><a href="#client_body_temp_path">client_body_temp_path</a></li><li><a href="#client_body_timeout">client_body_timeout</a></li><li><a href="#client_header_buffer_size">client_header_buffer_size</a></li><li><a href="#client_header_timeout">client_header_timeout</a></li><li><a href="#client_max_body_size">client_max_body_size</a></li><li><a href="#connection_pool_size">connection_pool_size</a></li><li><a href="#default_type">default_type</a></li><li><a href="#directio">directio</a></li><li><a href="#directio_alignment">directio_alignment</a></li><li><a href="#disable_symlinks">disable_symlinks</a></li><li><a href="#error_page">error_page</a></li><li><a href="#etag">etag</a></li><li><a href="#http">http</a></li><li><a href="#if_modified_since">if_modified_since</a></li><li><a href="#ignore_invalid_headers">ignore_invalid_headers</a></li><li><a href="#internal">internal</a></li><li><a href="#keepalive_disable">keepalive_disable</a></li><li><a href="#keepalive_requests">keepalive_requests</a></li><li><a href="#keepalive_timeout">keepalive_timeout</a></li><li><a href="#large_client_header_buffers">large_client_header_buffers</a></li><li><a href="#limit_except">limit_except</a></li><li><a href="#limit_rate">limit_rate</a></li><li><a href="#limit_rate_after">limit_rate_after</a></li><li><a href="#lingering_close">lingering_close</a></li><li><a href="#lingering_time">lingering_time</a></li><li><a href="#lingering_timeout">lingering_timeout</a></li><li><a href="#listen">listen</a></li><li><a href="#location">location</a></li><li><a href="#log_not_found">log_not_found</a></li><li><a href="#log_subrequest">log_subrequest</a></li><li><a href="#max_ranges">max_ranges</a></li><li><a href="#merge_slashes">merge_slashes</a></li><li><a href="#msie_padding">msie_padding</a></li><li><a href="#msie_refresh">msie_refresh</a></li><li><a href="#open_file_cache">open_file_cache</a></li><li><a href="#open_file_cache_errors">open_file_cache_errors</a></li><li><a href="#open_file_cache_min_uses">open_file_cache_min_uses</a></li><li><a href="#open_file_cache_valid">open_file_cache_valid</a></li><li><a href="#output_buffers">output_buffers</a></li><li><a href="#port_in_redirect">port_in_redirect</a></li><li><a href="#postpone_output">postpone_output</a></li><li><a href="#read_ahead">read_ahead</a></li><li><a href="#recursive_error_pages">recursive_error_pages</a></li><li><a href="#request_pool_size">request_pool_size</a></li><li><a href="#reset_timedout_connection">reset_timedout_connection</a></li><li><a href="#resolver">resolver</a></li><li><a href="#resolver_timeout">resolver_timeout</a></li><li><a href="#root">root</a></li><li><a href="#satisfy">satisfy</a></li><li><a href="#send_lowat">send_lowat</a></li><li><a href="#send_timeout">send_timeout</a></li><li><a href="#sendfile">sendfile</a></li><li><a href="#sendfile_max_chunk">sendfile_max_chunk</a></li><li><a href="#server">server</a></li><li><a href="#server_name">server_name</a></li><li><a href="#server_name_in_redirect">server_name_in_redirect</a></li><li><a href="#server_names_hash_bucket_size">server_names_hash_bucket_size</a></li><li><a href="#server_names_hash_max_size">server_names_hash_max_size</a></li><li><a href="#server_tokens">server_tokens</a></li><li><a href="#tcp_nodelay">tcp_nodelay</a></li><li><a href="#tcp_nopush">tcp_nopush</a></li><li><a href="#try_files">try_files</a></li><li><a href="#types">types</a></li><li><a href="#types_hash_bucket_size">types_hash_bucket_size</a></li><li><a href="#types_hash_max_size">types_hash_max_size</a></li><li><a href="#underscores_in_headers">underscores_in_headers</a></li><li><a href="#variables_hash_bucket_size">variables_hash_bucket_size</a></li><li><a href="#variables_hash_max_size">variables_hash_max_size</a></li></ul></li><li><a href="#embedded_variables">内嵌变量</a></li></ul><p><a id="directives"></a></p><h2 id="指令" tabindex="-1"><a class="header-anchor" href="#指令" aria-hidden="true">#</a> 指令</h2><h3 id="absolute-redirect" tabindex="-1"><a class="header-anchor" href="#absolute-redirect" aria-hidden="true">#</a> absolute_redirect</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>absolute_redirect</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">absolute_redirect on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 1.11.8 版本中出现</td></tr></tbody></table><p>如果禁用，nginx 发出的重定向将是相对的。</p><p>另请参阅 <a href="#server_name_in_redirect">server_name_in_redirect</a> 和 <a href="#port_in_redirect">port_in_redirect</a> 指令。</p><h3 id="aio" tabindex="-1"><a class="header-anchor" href="#aio" aria-hidden="true">#</a> aio</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>aio</strong> <code>on</code> | <code>off</code> | <code>threads[=pool]</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">aio off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 0.8.11 版本中出现</td></tr></tbody></table><p>启用或禁用在 FreeBSD 和 Linux 上使用异步文件 I/O（AIO）：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /video/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">aio</span>            <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">output_buffers</span> <span class="token number">1</span> <span class="token number">64k</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在 FreeBSD 上，AIO 从 FreeBSD 4.3 开始可用。在 FreeBSD 11.0 之前，可以将 AIO 静态链接到内核中：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>options VFS_AIO
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>或作为一个内核可加载模块动态加载：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>kldload aio
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>在 Linux 上，AIO 从内核版本为 2.6.22 开始可用。此外，有必要启用 <a href="#directio">directio</a>，否则读取将被阻塞：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /video/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">aio</span>            <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">directio</span>       <span class="token number">512</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">output_buffers</span> <span class="token number">1</span> <span class="token number">128k</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在 Linux 上，<a href="#directio">directio</a> 只能用于读取 512 字节边界对齐的块（或 XFS 4K）。文件未对齐的末端以阻塞模式读取。对于字节范围请求和不是从文件开头开始的 FLV 请求也是如此：在文件的开头和结尾读取未对齐的数据将被阻塞。</p><p>当在 Linux 上启用 AIO 和 <a href="#sendfile">sendfile</a> 时，AIO 用于大于或等于 <a href="#directio">directio</a> 指令指定大小的文件，而 <a href="#sendfile">sendfile</a> 用于较小的文件（禁用 <a href="#directio">directio</a> 时也是如此）。</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /video/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">sendfile</span>       <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">aio</span>            <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">directio</span>       <span class="token number">8m</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>最后，可以使用多线程（1.7.11）读取和<a href="#sendfile">发送</a>文件，不会阻塞工作进程：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /video/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">sendfile</span>       <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">aio</span>            threads</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>读取和发送文件操作被卸载到指定<a href="#thread_pool">池</a>中的线程。如果省略池名称，则使用名称为 <code>default</code> 的池。池名也可以用变量设置：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">aio</span> threads=pool<span class="token variable">$disk</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>默认情况下，多线程是禁用状态，它应该使用 <code>--with-threads</code> 配置参数启用。目前，多线程仅与 <a href="http://nginx.org/en/docs/events.html#epoll" target="_blank" rel="noopener noreferrer">epoll<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>、<a href="http://nginx.org/en/docs/events.html#kqueue" target="_blank" rel="noopener noreferrer">kqueue<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 和 <a href="http://nginx.org/en/docs/events.html#eventport" target="_blank" rel="noopener noreferrer">eventport<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 方式兼容。仅在 Linux 上支持多线程发送文件。</p><p>另请参见 <a href="#sendfile">sendfile</a> 指令。</p><h3 id="aio-write" tabindex="-1"><a class="header-anchor" href="#aio-write" aria-hidden="true">#</a> aio_write</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>aio_write</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">aio_write off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 1.9.13 版本中出现</td></tr></tbody></table><p>如果启用 <a href="#aio">aio</a>，则指定是否写入文件。目前，这仅在使用 aio 线程时有效，并且仅限于将从代理服务器接收的数据写入临时文件。</p><h3 id="alias" tabindex="-1"><a class="header-anchor" href="#alias" aria-hidden="true">#</a> alias</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>alias</strong> <code>path</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">location</td></tr></tbody></table><p>定义指定 location 的替换。例如，使用以下配置</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /i/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">alias</span> /data/w3/images/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>/i/top.gif</code> 的请求，将发送 <code>/data/w3/images/top.gif</code> 文件。</p><p><code>path</code> 值可以包含变量，除 <code>$document_root</code> 和 <code>$realpath_root</code> 外。</p><p>如果在使用正则表达式定义的 location 内使用了别名，那么这种正则表达式应该包含捕获，并且别名应该引用这些捕获（0.7.40），例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ ^/users/(.+\.(?:gif|jpe?g|png))$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">alias</span> /data/w3/images/<span class="token variable">$1</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>当 location 与指令值的最后一部分匹配时：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /images/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">alias</span> /data/w3/images/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>更好的方式是使用 <a href="#root">root</a> 指令：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /images/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /data/w3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="chunked-transfer-encoding" tabindex="-1"><a class="header-anchor" href="#chunked-transfer-encoding" aria-hidden="true">#</a> chunked_transfer_encoding</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>chunked_transfer_encoding</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">chunked_transfer_encoding on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>允许在 HTTP/1.1 中禁用分块传输编码。在使用的软件未能支持分块编码时它可能会派上用场。</p><h3 id="client-body-buffer-size" tabindex="-1"><a class="header-anchor" href="#client-body-buffer-size" aria-hidden="true">#</a> client_body_buffer_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>client_body_buffer_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">client_body_buffer_size 8k</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置读取客户端请求体的缓冲区大小。如果请求体大于缓冲区，则整个体或仅将其部分写入<a href="#client_body_temp_path">临时文件</a>。默认情况下，缓冲区大小等于两个内存页。在 x86、其他 32 位平台和 x86-64 上是 8K。在其他 64 位平台上通常为 16K。</p><h3 id="client-body-in-file-only" tabindex="-1"><a class="header-anchor" href="#client-body-in-file-only" aria-hidden="true">#</a> client_body_in_file_only</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>client_body_in_file_only</strong> <code>on</code> | <code>clean</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">client_body_in_file_only off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>确定 nginx 是否应将整个客户端请求体保存到文件中。可以在调试期间或使用 <code>$request_body_file</code> 变量或模块 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_perl_module.html" class="">ngx_http_perl_module</a> 的 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_perl_module.html#methods" class="">$r-&gt;request_body_file</a> 方法时使用此指令。</p><p>当设置为 <code>on</code> 值时，临时文件在请求处理后不会被删除。</p><p>值 <code>clean</code> 会将请求处理后剩下的临时文件删除。</p><h3 id="client-body-in-single-buffer" tabindex="-1"><a class="header-anchor" href="#client-body-in-single-buffer" aria-hidden="true">#</a> client_body_in_single_buffer</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>client_body_in_single_buffer</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">client_body_in_single_buffer off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>确定 nginx 是否应将整个客户端请求体保存在单个缓冲区中。在使用 <code>$request_body</code> 变量时，建议使用该指令，用来保存涉及的复制操作次数。</p><h3 id="client-body-temp-path" tabindex="-1"><a class="header-anchor" href="#client-body-temp-path" aria-hidden="true">#</a> client_body_temp_path</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>client_body_temp_path</strong> <code>path [level1 [level2 [level3]]]</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">client_body_temp_path client_body_temp;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>定义用于存储持有客户端请求主体的临时文件的目录。最多可以在指定目录下使用三级子目录层次结构。例如以下配置</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">client_body_temp_path</span> /spool/nginx/client_temp <span class="token number">1</span> <span class="token number">2</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>临时文件的路径可以如下：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>/spool/nginx/client_temp/7/45/00000123457
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="client-body-timeout" tabindex="-1"><a class="header-anchor" href="#client-body-timeout" aria-hidden="true">#</a> client_body_timeout</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>client_body_timeout</strong> <code>time</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">client_body_timeout 60s;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>定义读取客户端请求正文的超时时间。超时设置仅是在两个连续读操作之间的时间间隔，而不是整个请求体的传输过程。如果客户端在此时间内没有发送任何内容，则会将 408（请求超时）错误返回给客户端。</p><h3 id="client-header-buffer-size" tabindex="-1"><a class="header-anchor" href="#client-header-buffer-size" aria-hidden="true">#</a> client_header_buffer_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>client_header_buffer_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">client_header_buffer_size 1k;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server</td></tr></tbody></table><p>设置读取客户端请求头的缓冲区大小。对于大多数请求，1K 字节的缓冲区就足够了。但是，如果请求中包含长 cookie，或者来自 WAP 客户端，则可能 1K 是不适用的。如果请求行或请求头域不适合此缓冲区，则会分配由 <a href="#large_client_header_buffers">large_client_header_buffers</a> 指令配置的较大缓冲区。</p><h3 id="client-header-timeout" tabindex="-1"><a class="header-anchor" href="#client-header-timeout" aria-hidden="true">#</a> client_header_timeout</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>client_header_timeout</strong> <code>time</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">client_header_timeout 60s;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server</td></tr></tbody></table><p>定义读取客户端请求头的超时时间。如果客户端在这段时间内没有传输整个报头，则将 408（请求超时）错误返回给客户端。</p><h3 id="client-max-body-size" tabindex="-1"><a class="header-anchor" href="#client-max-body-size" aria-hidden="true">#</a> client_max_body_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>client_header_timeout</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">client_max_body_size 1m;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>在 <strong>Content-Length</strong> 请求头域中指定客户端请求体的最大允许大小。如果请求的大小超过配置值，则将 413 （请求实体过大）错误返回给客户端。请注意，浏览器无法正确显示此错误。将 <code>size</code> 设置为 0 将禁用检查客户端请求正文大小。</p><h3 id="connection-pool-size" tabindex="-1"><a class="header-anchor" href="#connection-pool-size" aria-hidden="true">#</a> connection_pool_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>connection_pool_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">connection_pool_size 256</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server</td></tr></tbody></table><p>允许精确调整每个连接的内存分配。该指令对性能影响最小，一般不建议使用。默认情况下，32 位平台上的大小为 256 字节，64 位平台上为 512 字节。</p><blockquote><p>在 1.9.8 版本之前，所有平台上的默认值都为 256。</p></blockquote><h3 id="default-type" tabindex="-1"><a class="header-anchor" href="#default-type" aria-hidden="true">#</a> default_type</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>default_type</strong> <code>mime-type</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">default_type text/plain;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>定义响应的默认 MIME 类型。可以使用 <a href="#types">types</a> 指令对 MIME 类型的文件扩展名进行映射。</p><h3 id="directio" tabindex="-1"><a class="header-anchor" href="#directio" aria-hidden="true">#</a> directio</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>directio</strong> <code>size</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">directio off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>开启当读取大于或等于指定大小的文件时，使用 <code>O_DIRECT</code> 标志（FreeBSD、Linux）、<code>F_NOCACHE</code> 标志（macOS）或 <code>directio()</code> 函数（Solaris）。该指令自动禁用（0.7.15）给定请求使用的 <a href="#sendfile">sendfile</a>。它可以用于服务大文件：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">directio</span> <span class="token number">4m</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>或当在 Linux 上使用 <a href="#aio">aio</a> 时。</p><h3 id="directio-alignment" tabindex="-1"><a class="header-anchor" href="#directio-alignment" aria-hidden="true">#</a> directio_alignment</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>directio_alignment</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">directio_alignment 512;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 0.8.11 版本中出现</td></tr></tbody></table><p>设置 <a href="#directio">directio</a> 的对齐方式。在大多数情况下，512 字节的对齐就足够了。但是，在 Linux 下使用 XFS 时，需要增加到 4K。</p><h3 id="disable-symlinks" tabindex="-1"><a class="header-anchor" href="#disable-symlinks" aria-hidden="true">#</a> disable_symlinks</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>disable_symlinks</strong> <code>off</code>; <br> <strong>disable_symlinks on</strong> | <code>if_not_owner [from=part]</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">disable_symlinks off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 1.1.15 版本中出现</td></tr></tbody></table><p>确定打开文件时应如何处理符号链接：</p><ul><li><p><code>off</code></p><p>允许路径名中的符号链接的，不执行检查。这是默认行为。</p></li><li><p><code>on</code></p><p>如果路径名存在是符号链接的组件，则拒绝对文件的访问。</p></li><li><p><code>if_not_owner</code></p><p>如果路径名存在是符号链接的组件，并且链接指向的链接和对象为不同所有者，则拒绝访问文件。</p></li><li><p><code>from=part</code></p><p>当检查符号链接（参数 <code>on</code> 和 <code>if_not_owner</code>）时，通常会检查路径名的所有组件。可以通过另外指定 <code>from=part</code> 参数来避免检查路径名的初始部分中的符号链接。在这种情况下，只能从指定的初始部分后面的路径名组件检查符号链接。如果该值不是检查的路径名的初始部分，则会检查整个路径名，相当于没有指定此参数。如果该值与整个文件名匹配，则不会检查符号链接。参数值可以包含变量。</p></li></ul><p>例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">disable_symlinks</span> <span class="token boolean">on</span> from=<span class="token variable">$document_root</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>此指令仅适用于具有 <code>openat()</code> 和 <code>fstatat()</code> 接口的系统。这样的系统包括现代版本的FreeBSD、Linux 和 Solaris。</p><p>参数 <code>on</code> 和 <code>if_not_owner</code> 增加了处理开销。</p><blockquote><p>在不支持打开目录仅用于搜索的系统上，要使用这些参数，需要 worker 进程对所有正在检查的目录具有读取权限。</p></blockquote><blockquote><p><a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_autoindex_module.html" class="">ngx_http_autoindex_module</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_random_index_module.html" class="">ngx_http_random_index_module</a> 和 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_dav_module.html" class="">ngx_http_dav_module</a> 模块目前忽略此指令。</p></blockquote><h3 id="error-page" tabindex="-1"><a class="header-anchor" href="#error-page" aria-hidden="true">#</a> error_page</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>error_page</strong> <code>code ... [=[response]] uri</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location、location 中的 if</td></tr></tbody></table><p>定义针对指定错误显示的 URI。<code>uri</code> 值可以包含变量。</p><p>例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span>             /404.html</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这会导致客户端请求方法更改为 <code>GET</code>，内部重定向到指定的 <code>uri</code>（除 <code>GET</code> 和 <code>HEAD</code> 之外的所有方法）。</p><p>此外，可以使用 <code>=response</code> 语法将修改响应代码，例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> =200 /empty.gif</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>如果错误响应是由代理服务器或 FastCGI/uwsgi/SCGI 服务器处理，并且服务器可能返回不同的响应代码（例如，200、302、401 或 404），则可以使用其返回的代码进行响应：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> = /404.php</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>如果在内部重定向时不需要更改 URI 和方法，则可以将错误处理传递给一个命名了的 location：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> = @fallback</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> @fallback</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>如果 <code>uri</code> 处理导致发生错误，最后发生错误的状态代码将返回给客户端。</p></blockquote><p>也可以使用 URL 重定向进行错误处理：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">403</span>      http://example.com/forbidden.html</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> =301 http://example.com/notfound.html</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在这种情况下，默认将响应代码 302 返回给客户端。它只能是重定向状态代码其中之一（301、302、303、307 和 308）。</p><blockquote><p>在 1.1.16 和 1.0.13 版本之前，代码 307 没有被视为重定向。</p></blockquote><blockquote><p>直到 1.13.0 版本，代码 308 才被视为重定向。</p></blockquote><p>当且仅当没有在当前级别上定义 error_page 指令时，指令才从上一级继承这些特性。</p><h3 id="etag" tabindex="-1"><a class="header-anchor" href="#etag" aria-hidden="true">#</a> etag</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>etag</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">etag on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 1.3.3 版本中出现</td></tr></tbody></table><p>启用或禁用自动生成静态资源 <strong>ETag</strong> 响应头字段。</p><h3 id="http" tabindex="-1"><a class="header-anchor" href="#http" aria-hidden="true">#</a> http</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>http</strong> <code>{ ... }</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">main</td></tr></tbody></table><p>提供指定 HTTP server 指令的配置文件上下文。</p><h3 id="if-modified-since" tabindex="-1"><a class="header-anchor" href="#if-modified-since" aria-hidden="true">#</a> if_modified_since</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>if_modified_since</strong> <code>off</code> | <code>exact</code> | <code>before</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">if_modified_since exact;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 0.7.24 版本中出现</td></tr></tbody></table><p>指定如何将响应的修改时间与 <strong>If-Modified-Since</strong> 请求头字段中的时间进行比较：</p><ul><li><p><code>off</code></p><p>忽略 <strong>If-Modified-Since</strong> 请求头字段（0.7.34）</p></li><li><p><code>exact</code></p><p>完全匹配</p></li><li><p><code>before</code></p><p>响应的修改时间小于或等于 <strong>If-Modified-Since</strong> 请求头字段中的时间</p></li></ul><h3 id="ignore-invalid-headers" tabindex="-1"><a class="header-anchor" href="#ignore-invalid-headers" aria-hidden="true">#</a> ignore_invalid_headers</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>ignore_invalid_headers</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">ignore_invalid_headers on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server</td></tr></tbody></table><p>控制是否应忽略具有无效名称的头字段。有效名称由英文字母、数字、连字符或下划线组成（由 <a href="#underscores_in_headers">underscores_in_headers</a> 指令控制）。</p><p>如果在 <a href="#server">server</a> 级别指定了该指令，则其值仅在 server 为默认 server 时使用。指定的值也适用于监听相同地址和端口的所有虚拟服务器。</p><h3 id="internal" tabindex="-1"><a class="header-anchor" href="#internal" aria-hidden="true">#</a> internal</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>internal</strong>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">location</td></tr></tbody></table><p>指定给定的 location 只能用于内部请求。对于外部请求，返回客户端错误 404（未找到）。内部请求如下：</p><ul><li>请求由 <a href="#error_page">error_page</a>、<a href="#index">index</a>、<a href="#random_index">random_index</a> 和 <a href="#try_files">try_files</a> 指令重定向</li><li>来 upstream server 的 <strong>X-Accel-Redirect</strong> 响应头字段重定向的请求</li><li>由 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_ssi_module.html" class="">ngx_http_ssi_module</a> 模块的 <code>include virtual</code> 命令、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_addition_module.html" class="">ngx_http_addition_module</a> 模块指令和 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_auth_request_module.html#auth_request" class="">auth_request</a> 和 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_mirror_module.html#mirror" class="">mirror</a> 指令组成的子请求</li><li>由 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_rewrite_module.html#rewrite" class="">rewrite</a> 指令更改的请求</li></ul><p>示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /404.html</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">location</span> /404.html</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">internal</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>每个请求限制 10 个内部重定向，以防止不正确配置引发的请求处理死循环。如果达到此限制，则返回错误 500（内部服务器错误）。在这种情况下，可以在错误日志中看到 <code>rewrite or internal redirection cycle</code> 消息。</p></blockquote><h3 id="keepalive-disable" tabindex="-1"><a class="header-anchor" href="#keepalive-disable" aria-hidden="true">#</a> keepalive_disable</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>keepalive_disable</strong> <code>none</code> | <code>browser ...</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">keepalive_disable msie6;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>禁用与行为异常的浏览器保持连接。<code>browser</code> 参数指定哪些浏览器将受到影响。一旦接收到 POST 请求，值 <code>msie6</code> 将禁用与旧版本 MSIE 保持连接。值 <code>safari</code> 禁用与 macOS 和类似 MacOS 的操作系统上的 Safari 和 Safari 浏览器保持连接。值 <code>none</code> 启用与所有浏览器保持连接。</p><blockquote><p>在 1.1.18 版本之前，值 <code>safari</code> 匹配所有操作系统上的所有 Safari 和类 Safari 浏览器，并且默认情况下，禁用与它们保持连接。</p></blockquote><h3 id="keepalive-requests" tabindex="-1"><a class="header-anchor" href="#keepalive-requests" aria-hidden="true">#</a> keepalive_requests</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>keepalive_requests</strong> <code>number</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">keepalive_requests 100;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 0.8.0 版本中出现</td></tr></tbody></table><p>设置通过一个保持活动（keep-alive）连接可以提供的最大请求数。在发出的请求达到最大数量后，连接将被关闭。</p><h3 id="keepalive-timeout" tabindex="-1"><a class="header-anchor" href="#keepalive-timeout" aria-hidden="true">#</a> keepalive_timeout</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>keepalive_timeout</strong> <code>timeout</code> <code>[header_timeout]</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">keepalive_timeout 75s;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>第一个参数设置一个超时时间，keep-alive 客户端连接将在服务端保持打开状态。零值将禁用 keep-alive 客户端连接。可选的第二个参数在 <strong>Keep-Alive: timeout=<code>time</code></strong> 响应头域中设置一个值。两个参数可能不同。</p><p>Mozilla 和 Konqueror 会识别 **Keep-Alive: timeout=<code>time</code> 头字段。MSIE 在大约在 60 秒钟内自行关闭 keep-alive 连接。</p><h3 id="large-client-header-buffers" tabindex="-1"><a class="header-anchor" href="#large-client-header-buffers" aria-hidden="true">#</a> large_client_header_buffers</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>large_client_header_buffers</strong> <code>number size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">arge_client_header_buffers 4 8k;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server</td></tr></tbody></table><p>设置用于读取大客户端请求头的缓冲区的最大 <code>number</code>（数量）和 <code>size</code>（大小）。请求行不能超过一个缓冲区的大小，否则将返回 414（请求 URI 太长）错误给客户端。请求头字段也不能超过一个缓冲区的大小，否则将返回 400（错误请求）错误给客户端。缓冲区只能按需分配。默认情况下，缓冲区大小等于 8K 字节。如果在请求处理结束之后，连接被转换为 keep-alive 状态，这些缓冲区将被释放。</p><h3 id="limit-except" tabindex="-1"><a class="header-anchor" href="#limit-except" aria-hidden="true">#</a> limit_except</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>limit_except</strong> <code>method ... { ... }</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">location</td></tr></tbody></table><p>限制给定的 location 内允许的 HTTP 方法。<code>method</code> 参数可以是以下之一：<code>GET</code>、<code>HEAD</code>、<code>POST</code>、<code>PUT</code>、<code>DELETE</code>、<code>MKCOL</code>、<code>COPY</code>、<code>MOVE</code>、<code>OPTIONS</code>、<code>PROPFIND</code>、<code>PROPPATCH</code>、<code>LOCK</code>、<code>UNLOCK</code> 或 <code>PATCH</code>。允许 <code>GET</code> 方法也将使得 <code>HEAD</code>方法被允许。可以使用 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_access_module.html" class="">ngx_http_access_module</a> 和 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_auth_basic_module.html" class="">ngx_http_auth_basic_module</a> 模块指令来限制对其他方法的访问：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">limit_except</span> GET</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">allow</span> 192.168.1.0/32</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">deny</span>  all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>请注意，这将限制访问除 <code>GET</code> 和 <code>HEAD</code> 之外的所有方法。</p><h3 id="limit-rate" tabindex="-1"><a class="header-anchor" href="#limit-rate" aria-hidden="true">#</a> limit_rate</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>limit_rate</strong> <code>rate</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">limit_rate 0;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location、location 中的 if</td></tr></tbody></table><p>限制客户端的响应传输速率。<code>rate</code> 以字节/秒为单位。零值将禁用速率限制。限制设置是针对每个请求，因此如果客户端同时打开两个连接，则整体速率将是指定限制的两倍。</p><p>也可以在 <code>$limit_rate</code> 变量中设置速率限制。根据某些条件来限制速率可能会有用：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>

    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$slow</span>)</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$limit_rate</span> <span class="token number">4k</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>也可以在代理服务器响应的 <strong>X-Accel-Limit-Rate</strong> 头字段中设置速率限制。可以使用 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_proxy_module.html#proxy_ignore_headers" class="">proxy_ignore_headers</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_fastcgi_module.html#fastcgi_ignore_headers" class="">fastcgi_ignore_headers</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_uwsgi_module.html#uwsgi_ignore_headers" class="">uwsgi_ignore_headers</a> 和 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_scgi_module.html#scgi_ignore_headers" class="">scgi_ignore_headers</a> 指令禁用此功能。</p><h3 id="lingering-time" tabindex="-1"><a class="header-anchor" href="#lingering-time" aria-hidden="true">#</a> lingering_time</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>lingering_time</strong> <code>time</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">lingering_time 30s;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>当 <a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#lingering_close" class="router-link-active router-link-exact-active">lingering_close</a> 生效时，该指令指定 nginx 处理（读取和忽略）来自客户端的额外数据的最长时间。之后，连接将被关闭，即使还有更多的数据。</p><h3 id="lingering-timeout" tabindex="-1"><a class="header-anchor" href="#lingering-timeout" aria-hidden="true">#</a> lingering_timeout</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>lingering_timeout</strong> <code>time</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">lingering_timeout 5s;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>当 <a aria-current="page" href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_core_module.html#lingering_close" class="router-link-active router-link-exact-active">lingering_close</a> 生效时，该指令指定更多的客户端数据到达的最长等待时间。如果在此期间未收到数据，则关闭连接。否则，读取和忽略数据，nginx 再次开始等待更多的数据。<strong>wait-read-ignore</strong> 循环被重复，但不再由 <a href="#lingering_time">lingering_time</a> 指令指定。</p><h3 id="listen" tabindex="-1"><a class="header-anchor" href="#listen" aria-hidden="true">#</a> listen</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>listen</strong> <code>address[:port] [default_server] [ssl] [http2 | spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]</code>; <br> <strong>listen</strong> <code>port [default_server] [ssl] [http2 | spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]</code>; <br> <strong>listen</strong> <code>unix:path [default_server] [ssl] [http2 | spdy] [proxy_protocol] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">listen *:80 | *:8000;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">server</td></tr></tbody></table><p>设置 IP 的 <code>address</code> （地址）和 <code>port</code> （端口），或服务器接受请求的 UNIX 域套接字的 <code>path</code> （路径）。可以同时指定 <code>addres</code> （地址）和 <code>port</code> （端口），也可以只指定 <code>address</code> （地址）或 <code>port</code> （端口）。<code>address</code> 也可以是主机名，例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">listen</span> 127.0.0.1:8000</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">listen</span> 127.0.0.1</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">listen</span> <span class="token number">8000</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">listen</span> *:8000</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">listen</span> localhost:8000</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>IPv6 地址（0.7.36）在方括号中指定：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">listen</span> [::]:8000</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">listen</span> [::1]</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>UNIX 域套接字（0.8.21）用 <code>unix:</code> 前缀指定：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">listen</span> unix:/var/run/nginx.sock</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>如果只指定 <code>address</code>，则使用 80 端口。</p><p>如果指令不存在，那么如果 nginx 是以超级用户权限运行，则使用 <code>*:80</code>，否则使用 <code>*:8000</code>。</p><p><code>default_server</code> 参数（如果存在）将使得服务器成为指定 <code>address:port</code> 对的默认服务器。如果没有指令有 <code>default_server</code> 参数，那么具有 <code>address:port</code> 对的第一个服务器将是该对的默认服务器。</p><blockquote><p>在 0.8.21 之前的版本中，此参数简单地命名为 <code>default</code>。</p></blockquote><p><code>ssl</code> 参数（0.7.14）允许指定该端口上接受的所有连接都应该工作在 SSL 模式。这样可以为处理 HTTP 和 HTTPS 请求的服务器提供更紧凑的<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/%E4%BB%8B%E7%BB%8D/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8.html#single_http_https_server" class="">配置</a>。</p><p><code>http2</code> 参数（1.9.5）配置端口接受 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_v2_module.html" class="">HTTP/2</a> 连接。通常，为了能够工作，还应该指定 <code>ssl</code> 参数，但也可以将 nginx 配置为接受没有 SSL 的 HTTP/2 连接。</p><p><code>spdy</code> 参数（1.3.15 — 1.9.4）允许在此端口上接受 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_spdy_module.html" class="">SPDY</a> 连接。通常，为了能够工作，还应该指定 <code>ssl</code> 参数，但也可以将 nginx 配置为接受没有 SSL 的 SPDY 连接。</p><p><code>proxy_protocol</code> 参数（1.5.12）允许指定此端口上接受的所有连接都应使用 <a href="http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt" target="_blank" rel="noopener noreferrer">PROXY 协议<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>。</p><p><code>listen</code> 指令可以有特定于套接字相关系统调用的几个附加参数。这些参数可以在任何 <code>listen</code> 指令中指定，但对于给定的 <code>address:port</code> 只能使用一次。</p><blockquote><p>在 0.8.21 之前的版本中，它们只能在 <code>listen</code> 指令中与默认参数一起指定。</p></blockquote><ul><li><p><code>setfib=number</code></p><p>此参数（0.8.44）设置相关联的路由表，监听套接字的 FIB（<code>SO_SETFIB</code> 选项）。目前只适用于 FreeBSD。</p></li><li><p><code>fastopen=number</code></p><p>为侦听套接字启用 <strong><a href="http://en.wikipedia.org/wiki/TCP_Fast_Open" target="_blank" rel="noopener noreferrer">TCP Fast Open<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></strong> （1.5.8），并限制尚未完成三次握手的连接队列的最大长度。</p><blockquote><p>不要启用此功能，除非服务器可以一次处理接收多个<a href="https://tools.ietf.org/html/rfc7413#section-6.1" target="_blank" rel="noopener noreferrer">相同的 SYN 包的数据<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>。</p></blockquote></li><li><p><code>backlog=number</code></p><p>在 <code>listen()</code> 调用中设置限制挂起连接队列的最大长度的<code>backlog</code> 参数。默认情况下，FreeBSD、DragonFly BSD 和 macOS 上的 <code>backlog</code> 设置为 -1，在其他平台上设置为 511。</p></li><li><p><code>rcvbuf=size</code></p><p>设置侦听套接字的接收缓冲区大小（<code>SO_RCVBUF</code> 选项）。</p></li><li><p><code>sndbuf=size</code></p><p>设置侦听套接字的发送缓冲区大小（<code>SO_SNDBUF</code> 选项）。</p></li><li><p><code>accept_filter=filter</code></p><p>为侦听套接字设置接受过滤器（<code>SO_ACCEPTFILTER</code> 选项）的名称，该套接字将传入的连接在传递给 <code>accept()</code> 之前进行过滤。这只适用于 FreeBSD 和 NetBSD 5.0+。可设置值<a href="http://man.freebsd.org/accf_data" target="_blank" rel="noopener noreferrer">dataready<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 或 <a href="http://man.freebsd.org/accf_http" target="_blank" rel="noopener noreferrer">httpready<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>。</p></li><li><p><code>deferred</code></p><p>指示在 Linux 上使用延迟 <code>accept()</code>（<code>TCP_DEFER_ACCEPT</code> 套接字选项）。</p></li><li><p><code>bind</code></p><p>指示为给定的 <code>address:port</code> 对单独进行 <code>bind()</code> 调用。这是有用的，因为如果有多个有相同端口但不同地址的 <code>listen</code> 指令，并且其中一个 <code>listen</code> 指令监听给定端口（<code>*:port</code>）的所有地址，则 nginx 将 <code>bind()</code> 应用到<code>*:port</code>。应该注意的是，在这种情况下将会进行 <code>getsockname()</code> 系统调用，以确定接受该连接的地址。如果使用 <code>setfib</code>、<code>backlog</code>、<code>rcvbuf</code>、<code>sndbuf</code>、<code>accept_filter</code>、<code>deferred</code>、<code>ipv6only</code> 或 <code>so_keepalive</code> 参数，那么对于给定的 <code>address:port</code> 对将始终进行单独的 <code>bind()</code> 调用。</p></li><li><p><code>ipv6only=ON|OFF</code></p><p>此参数（0.7.42）确定（通过 <code>IPV6_V6ONLY</code> 套接字选项）一个监听通配符地址 <code>[::]</code> 的 IPv6 套接字是否仅接受 IPv6 连接或 IPv6 和 IPv4 连接。此参数默认为开启。它只能在启动时设置一次。</p><blockquote><p>在 1.3.4 版本之前，如果省略该参数，则操作系统的设置将对于套接字产生影响。</p></blockquote></li><li><p><code>reuseport</code></p><p>此参数（1.9.1）指示为每个工作进程创建一个单独的监听套接字（使用 <code>SO_REUSEPORT</code> 套接字选项），允许内核在工作进程之间分配传入的连接。目前只适用于 Linux 3.9+ 和 DragonFly BSD。</p><blockquote><p>不当地使用此选项可能会带来安全<a href="http://man7.org/linux/man-pages/man7/socket.7.html" target="_blank" rel="noopener noreferrer">隐患<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>。</p></blockquote></li><li><p><code>SO_KEEPALIVE=ON|OFF|[keepidle]:[keepintvl]:[keepcnt]</code></p><p>此参数（1.1.11）配置监听套接字的 <strong>TCP keepalive</strong> 行为。如果省略此参数，则操作系统的设置将对套接字产生影响。如果设置为 <code>on</code>，则套接字将打开 <code>SO_KEEPALIVE</code> 选项。如果设置为 <code>off</code>，则 <code>SO_KEEPALIVE</code> 选项将被关闭。一些操作系统支持在每个套接字上使用 <code>TCP_KEEPIDLE</code>、<code>TCP_KEEPINTVL</code> 和 <code>TCP_KEEPCNT</code> 套接字选项来设置 TCP keepalive 参数。在这样的系统上（目前为 Linux 2.4+、NetBSD 5+ 和 FreeBSD 9.0-STABLE），可以使用 <code>keepidle</code>、<code>keepintvl</code>和 <code>keepcnt</code> 参数进行配置。可以省略一个或两个参数，在这种情况下，相应套接字选项的系统默认设置将生效。例如，</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code>SO_KEEPALIVE=30m::10
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>将空闲超时（<code>TCP_KEEPIDLE</code>）设置为 30 分钟，将探测间隔（<code>TCP_KEEPINTVL</code>）设置为系统默认值，并将探测数量（<code>TCP_KEEPCNT</code>）设置为 10 个探测。</p></li></ul><p>示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">listen</span> 127.0.0.1 default_server accept_filter=dataready backlog=1024</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h3 id="location" tabindex="-1"><a class="header-anchor" href="#location" aria-hidden="true">#</a> location</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>location</strong> <code>[ = | ~ | ~* | ^~ ] uri { ... }</code>; <br> <strong>location</strong> <code>@name { ... }</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">server、location</td></tr></tbody></table><p>根据请求 URI 设置配置。</p><p>在解码以 <code>％XX</code> 形式编码的文本，解析对相对路径组件 <code>.</code> 和<code>..</code> 的引用并且将两个或更多个相邻斜线<a href="#merge_slashes">压缩</a>成单斜线之后，对规范化的 URI 执行匹配。</p><p>location 可以由前缀字符串定义，也可以由正则表达式定义。正则表达式前面使用<code>~*</code>修正符（用于不区分大小写的匹配）或 <code>~</code> 修正符（用于区分大小写的匹配）指定。要查找匹配给定请求的 location，nginx 首先检查使用前缀字符串（前缀 location）定义的 location。期间，前缀最长的 location 被匹配选中并记住。然后按照它们在配置文件中出现的顺序检查正则表达式。正则表达式的搜索将在第一次匹配时终止，并使用相应的配置。如果找不到正则表达式的匹配，则使用先前记住的前缀 location 的配置。</p><p>location 块可以嵌套，除了下面提到的一些例外。</p><p>对于不区分大小写的操作系统，如 macOS 和 Cygwin，与前缀字符串匹配忽略大小写（0.7.7）。但是，比较仅限于一个字节的区域设置。</p><p>正则表达式可以包含捕获（0.7.40），之后可以在其他指令中使用。</p><p>如果最长匹配的前缀 location 具有 <code>^~</code> 修正符，则不检查正则表达式。</p><p>另外，使用 <code>=</code> 修正符可以使 URI 和 location 的匹配精确。如果找到完全匹配，则搜索结束。例如，如果 <code>/</code> 请求频繁，那么定义 <code>location=/</code> 会加快这些请求的处理速度，因为搜索在第一次比较之后会立即终止。这样的 location 不能包含嵌套 location。</p><blockquote><p>从 0.7.1 到 0.8.41 版本，如果请求与没有 <code>=</code> 和 <code>^~</code> 修正符的前缀 location 匹配，则搜索也会终止，并且不再检查正则表达式。</p></blockquote><p>下面举一个例子来说明：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> = /</span> <span class="token punctuation">{</span>
    [ configuration A ]
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    [ configuration B ]
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> /documents/</span> <span class="token punctuation">{</span>
    [ configuration C ]
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> ^~ /images/</span> <span class="token punctuation">{</span>
    [ configuration D ]
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|jpeg)$</span> <span class="token punctuation">{</span>
    [ configuration E ]
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><code>/</code> 请求将与配置 A 匹配，<code>/index.html</code> 请求将匹配配置 B，<code>/documents/document.html</code> 请求将匹配配置 C，<code>/images/1.gif</code> 请求将匹配配置 D，<code>/documents/1.jpg</code> 请求将匹配配置 E。</p><p><code>@</code> 前缀定义了一个命名 location。这样的 location 不用于常规的请求处理，而是用于请求重定向。它们不能嵌套，也不能包含嵌套的 location。</p><p>如果某个 location 由以斜杠字符结尾的前缀字符串定义，并且请求由 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_proxy_module.html#proxy_pass" class="">proxy_pass</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_fastcgi_module.html#fastcgi_pass" class="">fastcgi_pass</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_uwsgi_module.html#uwsgi_pass" class="">uwsgi_pass</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_scgi_module.html#scgi_pass" class="">scgi_pass</a> 或 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_memcached_module.html#memcached_pass" class="">memcached_pa​​ss</a> 中的一个进行处理，则会执行特殊处理。为了响应 URI 为该字符串的请求，但没有以斜杠结尾，带有 301 代码的永久重定向将返回所请求的 URI，并附上斜线。如果不需要，可以像以下这样定义 URI 和 location 的精确匹配：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /user/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://user.example.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> = /user</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://login.example.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="log-not-found" tabindex="-1"><a class="header-anchor" href="#log-not-found" aria-hidden="true">#</a> log_not_found</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>log_not_found</strong> <code>on | off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">log_not_found on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用将文件未找到错误记录到 <a href="#error_log">error_log</a> 中。</p><h3 id="log-subrequest" tabindex="-1"><a class="header-anchor" href="#log-subrequest" aria-hidden="true">#</a> log_subrequest</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>log_subrequest</strong> <code>on | off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">log_subrequest off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用将子请求记录到 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_log_module.html#access_log" class="">access_log</a> 中。</p><h3 id="max-ranges" tabindex="-1"><a class="header-anchor" href="#max-ranges" aria-hidden="true">#</a> max_ranges</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>merge_slashes</strong> <code>number</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr><tr><td style="text-align:left;"><strong>提示</strong></td><td style="text-align:left;">该指令在 1.1.2 版本中出现</td></tr></tbody></table><p>限制 byte-range 请求中允许的最大范围数。如果没有指定字节范围，则处理超出限制的请求。 默认情况下，范围的数量不受限制。零值将完全禁用 byte-range 支持。</p><h3 id="merge-slashes" tabindex="-1"><a class="header-anchor" href="#merge-slashes" aria-hidden="true">#</a> merge_slashes</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>merge_slashes</strong> <code>on | off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">merge_slashes on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server</td></tr></tbody></table><p>启用或禁用将 URI 中两个或多个相邻斜线压缩为单斜线。</p><p>请注意，压缩对于正确匹配前缀字符串和正则表达式的 location 非常重要。没有它，将不匹配 <code>//scripts/one.php</code> 请求：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /scripts/</span> <span class="token punctuation">{</span>
    ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>并可能被作为一个静态文件处理。因此它需要被转换成 <code>/scripts/one.php</code>。</p><p>因为 base64 在内部使用 <code>/</code> 字符，所以如果 URI 包含 base64 编码的名称，则可能需要关闭压缩。但是，出于安全考虑，最好不要关闭压缩。</p><p>如果该指令是在 <a href="#server">server</a> 级别指定的，则仅在 server 是默认 server 时才使用该指令。指定的值也适用于监听相同地址和端口的所有虚拟服务器。</p><h3 id="msie-padding" tabindex="-1"><a class="header-anchor" href="#msie-padding" aria-hidden="true">#</a> msie_padding</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>msie_padding</strong> <code>on | off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">msie_padding on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用向状态超过 400 的 MSIE 客户端响应添加注释以将响应大小增加到 512 字节。</p><h3 id="msie-refresh" tabindex="-1"><a class="header-anchor" href="#msie-refresh" aria-hidden="true">#</a> msie_refresh</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>msie_refresh</strong> <code>on | off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">msie_refresh off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用发布刷新替代 MSIE 客户端重定向。</p><h3 id="open-file-cache" tabindex="-1"><a class="header-anchor" href="#open-file-cache" aria-hidden="true">#</a> open_file_cache</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>open_file_cache</strong> <code>off</code>; <br> <strong>open_file_cache</strong> <code>max=N [inactive=time]</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">open_file_cache off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>配置一个缓存，可以存储：</p><ul><li>打开文件描述符、大小和修改时间</li><li>有关目录是否存在信息</li><li>文件查找错误，如<strong>找不到文件</strong>、<strong>没有读取权限</strong>等</li></ul><blockquote><p>应该通过 <a href="#open_file_cache_errors">open_file_cache_errors</a> 指令分别启用缓存错误。</p></blockquote><p>该指令有以下参数：</p><ul><li><p><code>max</code></p><p>设置缓存中元素的最大数量。在缓存溢出时，最近最少使用的（LRU）元素将被移除</p></li><li><p><code>inactive</code></p><p>定义一个时间，在这个时间之后，元素在缓存中将被删除，默认是 60 秒</p></li><li><p><code>off</code></p><p>禁用缓存</p></li></ul><p>示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">open_file_cache</span>          max=1000 inactive=20s</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_valid</span>    <span class="token number">30s</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_min_uses</span> <span class="token number">2</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">open_file_cache_errors</span>   <span class="token boolean">on</span></span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="open-file-cache-errors" tabindex="-1"><a class="header-anchor" href="#open-file-cache-errors" aria-hidden="true">#</a> open_file_cache_errors</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>open_file_cache_errors</strong> <code>off</code> | <code>on</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">open_file_cache_errors off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>通过 <a href="#open_file_cache">open_file_cache</a> 启用或禁用文件查找错误缓存。</p><h3 id="open-file-cache-min-uses" tabindex="-1"><a class="header-anchor" href="#open-file-cache-min-uses" aria-hidden="true">#</a> open_file_cache_min_uses</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>open_file_cache_min_uses</strong> <code>number</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">open_file_cache_min_uses 1;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置由 <a href="#open_file_cache">open_file_cache</a> 指令的 <code>inactive</code> 参数配置的时间段内文件访问的最小 <code>number</code> （次数），这是文件描述符在缓存中保持打开状态所必需的。</p><h3 id="open-file-cache-valid" tabindex="-1"><a class="header-anchor" href="#open-file-cache-valid" aria-hidden="true">#</a> open_file_cache_valid</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>open_file_cache_valid</strong> <code>time</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">open_file_cache_valid 60s;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置 <a href="#open_file_cache">open_file_cache</a> 元素应该验证的时间。</p><h3 id="output-buffers" tabindex="-1"><a class="header-anchor" href="#output-buffers" aria-hidden="true">#</a> output_buffers</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>output_buffers</strong> <code>number size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">output_buffers 2 32k;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置从磁盘读取响应缓冲区的 <code>number</code> （数量）和 <code>size</code> （大小）。</p><blockquote><p>在 1.9.5 版本之前，默认值是 <code>1 32k</code>。</p></blockquote><h3 id="port-in-redirect" tabindex="-1"><a class="header-anchor" href="#port-in-redirect" aria-hidden="true">#</a> port_in_redirect</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>port_in_redirect</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">port_in_redirect on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用指定由 nginx 发出的<a href="#absolute_redirect">绝对</a>重定向中的端口。</p><blockquote><p>在重定向中使用的主服务器名称由 <a href="#server_name_in_redirect">server_name_in_redirect</a> 指令控制。</p></blockquote><h3 id="postpone-output" tabindex="-1"><a class="header-anchor" href="#postpone-output" aria-hidden="true">#</a> postpone_output</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>postpone_output</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">postpone_output 1460;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>如果指定的话，客户端数据的传输将被推迟，直到 nginx 至少有 <code>size</code> 字节的数据要发送。零值将禁止延迟数据传输。</p><h3 id="read-ahead" tabindex="-1"><a class="header-anchor" href="#read-ahead" aria-hidden="true">#</a> read_ahead</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>read_ahead</strong> <code>sizef</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">read_ahead 0;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置使用文件时内核的预读数量。</p><p>在 Linux 上，使用 <code>posix_fadvise</code>（<code>0, 0, 0, POSIX_FADV_SEQUENTIAL</code>）系统调用，因此 <code>size</code> 参数将被忽略。</p><p>在 FreeBSD 上，使用自 FreeBSD 9.0-CURRENT 后支持的 <code>fcntl</code>（<code>O_READAHEAD, size</code>）系统调用。FreeBSD 7 需要<a href="http://sysoev.ru/freebsd/patch.readahead.txt" target="_blank" rel="noopener noreferrer">打补丁<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>。</p><h3 id="recursive-error-pages" tabindex="-1"><a class="header-anchor" href="#recursive-error-pages" aria-hidden="true">#</a> recursive_error_pages</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>recursive_error_pages</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">reset_timedout_connection off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用使用 <a href="#error_page">error_page</a> 指令执行多个重定向。这种重定向的数量是<a href="#internal">有限</a>的。</p><h3 id="request-pool-size" tabindex="-1"><a class="header-anchor" href="#request-pool-size" aria-hidden="true">#</a> request_pool_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>request_pool_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">request_pool_size 4k;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server</td></tr></tbody></table><p>允许精确调整每个请求的内存分配。该指令对性能影响最小，一般不应该使用。</p><h3 id="reset-timedout-connection" tabindex="-1"><a class="header-anchor" href="#reset-timedout-connection" aria-hidden="true">#</a> reset_timedout_connection</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>reset_timedout_connection</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">reset_timedout_connection off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用重置超时连接。重置过程如下。在关闭一个套接字之前，<code>SO_LINGER</code> 选项超时值被设置为 0。当套接字关闭时，TCP RST 被发送到客户端，并且释放该套接字占用的所有内存。这有助于避免长时间持有一个缓冲区已经被填充 FIN_WAIT1 状态的已关闭套接字。</p><p>应该注意，超时的 keep-alive 连接被正常关闭。</p><h3 id="resolver" tabindex="-1"><a class="header-anchor" href="#resolver" aria-hidden="true">#</a> resolver</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>resolver</strong> `address ... [valid=time] [ipv6=on</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>将用于解析 upstream 服务器名称的名称服务器配置进指定的地址，例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver</span> 127.0.0.1 [:: 1]:5353</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>地址可以指定为域名或 IP 地址，也可以指定一个可选的端口（1.3.1，1.2.2）。如果没有指定端口，则使用端口 53。名称服务器以轮询方式查询。</p><blockquote><p>在 1.1.7 版本之前，只能配置一个名称服务器。从 1.3.1 和 1.2.2 版本开始，支持使用 IPv6 地址来指定名称服务器。</p></blockquote><p>默认情况下，nginx 将在解析时查找 IPv4 和 IPv6 地址。如果不想查找 IPv6 地址，则可以指定 <code>ipv6=off</code> 参数。</p><blockquote><p>从 1.5.8 版本开始，支持将名称解析为 IPv6 地址。</p></blockquote><p>默认情况下，nginx 使用响应的 TTL 值缓存回复。可选的 <code>valid</code> 参数可以覆盖它：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">resolver</span> 127.0.0.1 [:: 1]:5353 valid=30s</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>在 1.1.9 版本之前，缓存时间是不能调整的，nginx 总是缓存 5 分钟的回复。</p></blockquote><blockquote><p>为了防止 DNS 欺骗，建议在安全的可信任本地网络中配置 DNS 服务器。</p></blockquote><h3 id="satisfy" tabindex="-1"><a class="header-anchor" href="#satisfy" aria-hidden="true">#</a> satisfy</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>satisfy</strong> <code>all</code> | <code>any</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">satisfy all;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>如果所有（全部）或至少一个（任意一个） <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_access_module.html" class="">ngx_http_access_module</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_auth_basic_module.html" class="">ngx_http_auth_basic_module</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_auth_request_module.html" class="">ngx_http_auth_request_module</a> 或 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_auth_jwt_module.html" class="">ngx_http_auth_jwt_module</a> 模块允许访问，则允许访问。</p><p>示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">satisfy</span> any</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">allow</span> 192.168.1.0/32</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">deny</span>  all</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">auth_basic</span>           <span class="token string">&quot;closed site&quot;</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">auth_basic_user_file</span> conf/htpasswd</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="send-lowat" tabindex="-1"><a class="header-anchor" href="#send-lowat" aria-hidden="true">#</a> send_lowat</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>send_lowat</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">send_lowat 0;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>如果指令设置为非零值，nginx 将尝试通过使用 <a href="http://nginx.org/en/docs/events.html#kqueue" target="_blank" rel="noopener noreferrer">kqueue<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 方法的 <code>NOTE_LOWAT</code> 标志或<code>SO_SNDLOWAT</code> 套接字选项来最小化客户端套接字上的发送操作数。在这两种情况下都使用到了指定的 <code>size</code>。</p><p>该指令在 Linux、Solaris 和 Windows 上被忽略。</p><h3 id="send-timeout" tabindex="-1"><a class="header-anchor" href="#send-timeout" aria-hidden="true">#</a> send_timeout</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>send_timeout</strong> <code>time</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">send_timeout 60s;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置向客户端发送响应的超时时间。超时设置只限定在两次连续的写入操作之间，而不是用于整个响应的传输。如果客户端在此时间内没有收到任何内容，则连接将被关闭。</p><h3 id="sendfile" tabindex="-1"><a class="header-anchor" href="#sendfile" aria-hidden="true">#</a> sendfile</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>sendfile</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">sendfile off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location、location 中的 if</td></tr></tbody></table><p>启用或禁用 <code>sendfile()</code>。</p><p>从 nginx 0.8.12 和 FreeBSD 5.2.1 开始，可以用 <a href="#aio">aio</a> 来为 <code>sendfile()</code> 预加载数据：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /video/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">sendfile</span>       <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">tcp_nopush</span>     <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">aio</span>            <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在此配置中，使用 <code>SF_NODISKIO</code> 标志调用 <code>sendfile()</code>，使其不会阻塞磁盘 I/O，而是以报告数据不在内存中的方式代替。然后 nginx 通过读取一个字节来启动异步数据加载。在第一次读取时，FreeBSD 内核会将文件的第一个 128K 字节加载到内存中，但是下一次读取只能以 16K 块加载数据。可以使用 <a href="#read_ahead">read_ahead</a> 指令进行修改。</p><blockquote><p>在 1.7.11 版本之前，可以使用 <code>aio sendfile</code> 来启用预加载。</p></blockquote><h3 id="sendfile-max-chunk" tabindex="-1"><a class="header-anchor" href="#sendfile-max-chunk" aria-hidden="true">#</a> sendfile_max_chunk</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;">**sendfile_max_chunk ** <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">sendfile_max_chunk 0;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置为非零值时，可限制单个 <code>sendfile()</code> 调用时传输的数据量。如果没有限制，一个快速连接可能会完全占用工作进程。</p><h3 id="server" tabindex="-1"><a class="header-anchor" href="#server" aria-hidden="true">#</a> server</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>server</strong> <code>{ ... }</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http</td></tr></tbody></table><p>设置虚拟服务器的配置。基于 IP（基于 IP 地址）和基于名称（基于 <code>Host</code> 请求头字段）的虚拟服务器之间没有明确的界限。相反，<a href="#listen">listen</a> 指令描述应接受服务器连接的所有地址和端口，<a href="#server_name">server_name</a> 指令列出所有服务器名称。<a href="http://nginx.org/en/docs/http/request_processing.html" target="_blank" rel="noopener noreferrer">如何处理请求<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>文档中提供了配置示例。</p><h3 id="server-name" tabindex="-1"><a class="header-anchor" href="#server-name" aria-hidden="true">#</a> server_name</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>server_name</strong> <code>name ...</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">server_name &quot;&quot;;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">server</td></tr></tbody></table><p>设置虚拟服务器名称，例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com www.example.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>第一个名字将成为主服务器名称。</p><p>服务器名称可以包含一个星号（<code>*</code>）以代替名称的第一部分或最后一部分：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> example.com *.example.com www.example.*</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样的名称被称为通配符名称。</p><p>上面提到的前两个名字可以合并成一个：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> .example.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>也可以在服务器名称中使用正则表达式，在名称前面加上波浪号（<code>〜</code>）：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.example.com ~^www\d+\.example\.com$</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>正则表达式可以包含之后用于其他指令的捕获（0.7.40）：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> ~^(www\.)?(.+)$</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /sites/<span class="token variable">$2</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /sites/default</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在正则表达式中命名捕获创建变量（0.8.25），之后可在其他指令中使用：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> ~^(www\.)?(?&lt;domain&gt;.+)$</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /sites/<span class="token variable">$domain</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">root</span> /sites/default</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>如果指令参数设置为 <code>$hostname</code>（0.9.4），则将替换为机器的主机名。</p><p>也可以指定一个空的服务器名称（0.7.11）：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server_name</span> www.example.com <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>它允许这个服务器对给定的 address:port 对处理没有 <code>Host</code> 头的请求，而不是默认的服务器。这是默认设置。</p><blockquote><p>在 0.8.48 之前，默认使用机器的主机名。</p></blockquote><p>在按名称搜索虚拟服务器的过程中，如果名称与多个指定变体相匹配（例如，通配符名称和正则表达式匹配），将按照以下优先顺序选择第一个匹配变体：</p><ol><li>确切的名字</li><li>以星号开头的最长通配符名称，例如 <code>*.example.com</code></li><li>以星号结尾的最长通配符名称，例如 <code>mail.*</code></li><li>第一个匹配的正则表达式（按照配置文件中的出现顺序）</li></ol><p>服务器名称的详细描述在单独的<a href="http://nginx.org/en/docs/http/server_names.html" target="_blank" rel="noopener noreferrer">服务器名称<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>文档中提供。</p><h3 id="server-name-in-redirect" tabindex="-1"><a class="header-anchor" href="#server-name-in-redirect" aria-hidden="true">#</a> server_name_in_redirect</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>server_name</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">server_name_in_redirect off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用在由 nginx 发出的 <a href="#absolute_redirect">absolute</a> 指令中使用由 <a href="#server_name">server_name</a> 指令指定的主服务器名称。当禁用主服务器名称时，将使用 <code>Host</code> 请求头字段中的名称。如果此字段不存在，则使用服务器的 IP 地址。</p><p>重定向中使用端口由 <a href="#port_in_redirect">port_in_redirect</a> 指令控制。</p><h3 id="server-names-hash-bucket-size" tabindex="-1"><a class="header-anchor" href="#server-names-hash-bucket-size" aria-hidden="true">#</a> server_names_hash_bucket_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>server_names_hash_bucket_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">server_names_hash_bucket_size 32</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http</td></tr></tbody></table><p>设置服务器名称哈希表的存储桶大小。默认值取决于处理器缓存行的大小。设置哈希表的细节在单独的<a href="http://nginx.org/en/docs/hash.html" target="_blank" rel="noopener noreferrer">文档<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>中提供。</p><h3 id="server-names-hash-max-size" tabindex="-1"><a class="header-anchor" href="#server-names-hash-max-size" aria-hidden="true">#</a> server_names_hash_max_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>server_names_hash_max_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">server_names_hash_max_size 512;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http</td></tr></tbody></table><p>设置服务器名称哈希表的最大大小。设置哈希表的细节在单独的<a href="(http://nginx.org/en/docs/hash.html)">文档</a>中提供。</p><h3 id="server-tokens" tabindex="-1"><a class="header-anchor" href="#server-tokens" aria-hidden="true">#</a> server_tokens</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>server_tokens</strong> <code>on</code> | <code>off</code> | <code>build</code> | <code>string</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">server_tokens on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>在错误页面和 <code>Server</code> 响应头字段中启用或禁用发送 nginx 版本。</p><p><code>build</code> 参数（1.11.10）能够发送构建名称以及 nginx 版本。</p><p>此外，作为我们的<a href="http://nginx.com/products/?_ga=2.14041591.1300915338.1513355851-1890203964.1497190280" target="_blank" rel="noopener noreferrer">商业订阅<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>的一部分，从1.9.13 版本开始，可以使用带有变量的字符串显式设置错误页面上的签名和 <code>Server</code> 响应头字段值。指定空字符串将禁用 <code>Server</code> 字段的发送。</p><h3 id="tcp-nodelay" tabindex="-1"><a class="header-anchor" href="#tcp-nodelay" aria-hidden="true">#</a> tcp_nodelay</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>tcp_nodelay</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">tcp_nodelay on;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用 <code>TCP_NODELAY</code> 选项的使用。该选项仅在连接转换到 keep-alive 状态时启用。</p><h3 id="tcp-nopush" tabindex="-1"><a class="header-anchor" href="#tcp-nopush" aria-hidden="true">#</a> tcp_nopush</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>tcp_nopush</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">tcp_nopush off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>启用或禁用在 FreeBSD 上使用 <code>TCP_NOPUSH</code> 套接字选项或在 Linux 上使用 <code>TCP_CORK</code> 套接字选项。这些选项只有在使用 <a href="#sendfile">sendfile</a> 时才能使用。启用该选项将允许：</p><ul><li>在 Linux 和 FreeBSD 4 上，在同一包中可发送响应头和文件开头。</li><li>以完整包的方式发送一个文件</li></ul><h3 id="try-files" tabindex="-1"><a class="header-anchor" href="#try-files" aria-hidden="true">#</a> try_files</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>try_files</strong> <code>file ... uri</code>; <br> <strong>try_files</strong> <code>file ... =code</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">——</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">server、location</td></tr></tbody></table><p>以指定顺序检查文件是否存在，并使用第一个找到的文件进行请求处理。处理将在当前上下文中执行。指向文件的路径根据 <a href="#root">root</a> 和 <a href="#alias">alias</a> 指令从 <code>file</code> 参数构造。可以通过在名称末尾指定斜线来检查目录是否存在，例如，<code>$URI/</code>。如果找不到任何文件，则内部重定向将指向最后一个参数中指定的 <code>uri</code>。例如：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /images/</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> /images/default.gif</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> = /images/default.gif</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30s</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>最后一个参数也可以指向一个命名的 location ，如以下示例。从 0.7.51 版本开始，最后一个参数也可以是一个 <code>code</code>：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/index.html <span class="token variable">$uri</span>.html =404</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>代理 Mongrel 示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> /system/maintenance.html
              <span class="token variable">$uri</span> <span class="token variable">$uri</span>/index.html <span class="token variable">$uri</span>.html
              @mongrel</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> @mongrel</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://mongrel</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Drupal/FastCGI 示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ @drupal</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> @drupal</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">fastcgi_pass</span> ...</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME /path/to<span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_NAME     <span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_param</span> QUERY_STRING    <span class="token variable">$args</span></span><span class="token punctuation">;</span>

    ... other fastcgi_param&#39;s
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> @drupal</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">fastcgi_pass</span> ...</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME /path/to/index.php</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_NAME     /index.php</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">fastcgi_param</span> QUERY_STRING    q=<span class="token variable">$uri</span>&amp;<span class="token variable">$args</span></span><span class="token punctuation">;</span>

    ... other fastcgi_param&#39;s
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>在以下示例中</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ @drupal</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>try_files 指令相当于</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> = @drupal</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">log_not_found</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>还有一个示例</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> @drupal</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">fastcgi_pass</span> ...</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME /path/to<span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>

    ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在将请求传递给 FastCGI 服务器之前，try_files 将检查 PHP 文件是否存在。</p><p>Wordpress 与 Joomla 示例：</p><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ @wordpress</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> ~ \.php$</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> @wordpress</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">fastcgi_pass</span> ...</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME /path/to<span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span>
    ... other fastcgi_param&#39;s
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">location</span> @wordpress</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">fastcgi_pass</span> ...</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME /path/to/index.php</span><span class="token punctuation">;</span>
    ... other fastcgi_param&#39;s
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="types-hash-bucket-size" tabindex="-1"><a class="header-anchor" href="#types-hash-bucket-size" aria-hidden="true">#</a> types_hash_bucket_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>types_hash_bucket_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">types_hash_bucket_size 64;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置类型哈希表桶大小。设置哈希表的细节在单独的<a href="http://nginx.org/en/docs/hash.html" target="_blank" rel="noopener noreferrer">文档<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>中有提供。</p><blockquote><p>在版 1.5.13 本之前，默认值取决于处理器缓存行的大小。</p></blockquote><h3 id="types-hash-max-size" tabindex="-1"><a class="header-anchor" href="#types-hash-max-size" aria-hidden="true">#</a> types_hash_max_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>types_hash_max_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">types_hash_max_size 1024;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server、location</td></tr></tbody></table><p>设置类型哈希表的最大大小。设置哈希表的细节在单独的<a href="http://nginx.org/en/docs/hash.html" target="_blank" rel="noopener noreferrer">文档<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>中有提供。</p><h3 id="underscores-in-headers" tabindex="-1"><a class="header-anchor" href="#underscores-in-headers" aria-hidden="true">#</a> underscores_in_headers</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>underscores_in_headers</strong> <code>on</code> | <code>off</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">underscores_in_headers off;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http、server</td></tr></tbody></table><p>启用或禁用在客户端请求头字段中使用下划线。当禁用下划线时，名称中包含下划线的请求头字段将被标记为无效，并受制于 <a href="#ignore_invalid_headers">ignore_invalid_headers</a> 指令。</p><p>如果该指令是在 <a href="#server">server</a> 级别指定，则仅在 server 是默认 server 时才使用该指令。指定的值也适用于监听相同地址和端口的所有虚拟服务器。</p><h3 id="variables-hash-bucket-size" tabindex="-1"><a class="header-anchor" href="#variables-hash-bucket-size" aria-hidden="true">#</a> variables_hash_bucket_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>variables_hash_bucket_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">variables_hash_bucket_size size;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http</td></tr></tbody></table><p>设置变量哈希表桶大小。设置哈希表的细节在单独的<a href="http://nginx.org/en/docs/hash.html" target="_blank" rel="noopener noreferrer">文档<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>中有提供。</p><h3 id="variables-hash-max-size" tabindex="-1"><a class="header-anchor" href="#variables-hash-max-size" aria-hidden="true">#</a> variables_hash_max_size</h3><table><thead><tr><th style="text-align:left;">-</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>语法</strong></td><td style="text-align:left;"><strong>variables_hash_max_size</strong> <code>size</code>;</td></tr><tr><td style="text-align:left;"><strong>默认</strong></td><td style="text-align:left;">variables_hash_max_size 1024;</td></tr><tr><td style="text-align:left;"><strong>上下文</strong></td><td style="text-align:left;">http</td></tr></tbody></table><p>设置变量哈哈希表的最大大小。设置哈希表的细节在单独的<a href="http://nginx.org/en/docs/hash.html" target="_blank" rel="noopener noreferrer">文档<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>中有提供。</p><blockquote><p>在 1.5.13 版本之前，默认值是 512。</p></blockquote><p><a id="embedded_variables"></a></p><h2 id="内嵌变量" tabindex="-1"><a class="header-anchor" href="#内嵌变量" aria-hidden="true">#</a> 内嵌变量</h2><p><code>ngx_http_core_module</code> 模块支持嵌入式变量名称与 Apache 服务器变量匹配。首先，这些是出现在客户端请求头字段的变量，例如 <code>$http_user_agent</code>、<code>$http_cookie</code> 等等。还有其他变量：</p><ul><li><p><code>$arg_name</code></p><p>请求行中的 <code>name</code> 参数</p></li><li><p><code>$args</code></p><p>请求行中的参数</p></li><li><p><code>$binary_remote_addr</code></p><p>客户端地址以二进制形式表示，值的长度对于 IPv4 地址总是 4 个字节，对于 IPv6 地址总是 16 个字节</p></li><li><p><code>$body_bytes_sent</code></p><p>发送到客户端的字节数，不包括响应头。此变量与 <code>mod_log_config</code> Apache 模块的 <code>％B</code> 参数兼容</p></li><li><p><code>$bytes_sent</code></p><p>发送到客户端的字节数（1.3.8、1.2.5）</p></li><li><p>$connection</p><p>连接序列号（1.3.8、1.2.5）</p></li><li><p><code>$connection_requests</code></p><p>当前通过连接请求的请求数（1.3.8、1.2.5）</p></li><li><p><code>$connect_length</code></p><p><code>Content-Length</code> 请求头字段</p></li><li><p><code>$content_type</code></p><p><code>Content-Type</code> 请求头字段</p></li><li><p><code>$cookie_name</code></p><p>名称为 <code>name</code> 的 cookie</p></li><li><p><code>$document_root</code></p><p>根目录或别名指令的当前请求的值</p></li><li><p><code>$document_uri</code></p><p>与 <code>$uri</code> 相同</p></li><li><p><code>$host</code></p><p>按照以下优先顺序：来自请求行的主机名，来自 <code>Host</code> 请求头字段的主机名，或与请求匹配的服务器名</p></li><li><p><code>$hostname</code></p><p>主机名</p></li><li><p><code>$http_name</code></p><p>任意请求头字段,变量名称的最后一部分是将字段名称转换为小写，并用破折号替换为下划线</p></li><li><p><code>$https</code></p><p>如果连接以 SSL 模式运行，则为 <code>on</code>，否则为空字符串</p></li><li><p><code>$is_args</code></p><p>如果请求行有参数则为 <code>?</code>，否则为空字符串</p></li><li><p><code>$limit_rate</code></p><p>设置这个变量可以实现响应速率限制，见 <a href="#limit_rate">limit_rate</a></p></li><li><p><code>$msec</code></p><p>当前时间以毫秒为单位（1.3.9、1.2.6）</p></li><li><p><code>$nginx_version</code></p><p>nginx 版本</p></li><li><p><code>$pid</code></p><p>工作进程的 PID</p></li><li><p><code>$pipe</code></p><p>如果请求是管道模式则为 <code>p</code>，否则为 <code>.</code>（1.3.12、1.2.7）</p></li><li><p><code>$proxy_protocol_addr</code></p><p>来自 PROXY 协议头的客户端地址，否则为空字符串（1.5.12）</p><p>要在 <a href="#listen">listen</a> 指令中设置 <code>proxy_protocol</code> 参数，必须先启用 PROXY 协议。</p></li><li><p><code>$proxy_protocol_port</code></p><p>PROXY 协议头中的客户端口，否则为空字符串（1.11.0）</p><p>要在 <a href="#listen">listen</a> 指令中设置 <code>proxy_protocol</code> 参数，必须先启用 PROXY 协议。</p></li><li><p><code>$query_string</code></p><p>与 <code>$args</code> 相同</p></li><li><p><code>$realpath_root</code></p><p>与当前请求的 <a href="#root">root</a> 或 <a href="#alias">alias</a> 指令值相对应的绝对路径名，所有符号链接都将解析为实际路径</p></li><li><p><code>$remote_addr</code></p><p>客户端地址</p></li><li><p><code>$remote_port</code></p><p>客户端端口</p></li><li><p><code>$remote_user</code></p><p>基本身份验证提供的用户名</p></li><li><p><code>$request</code></p><p>完整的原始请求行</p></li><li><p><code>$request_body</code></p><p>请求正文</p><p>当请求正文被读取到<a href="#client_body_buffer_size">内存缓冲区</a>时，变量的值在由<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/gx_http_proxy_module.html#proxy_pass" class="">proxy_pass</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_fastcgi_module.html#fastcgi_pass" class="">fastcgi_pass</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_uwsgi_module.html#uwsgi_pass" class="">uwsgi_pass</a> 和 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_scgi_module.html#scgi_pass" class="">scgi_pass</a> 指令处理的 location 中可用。</p></li><li><p><code>$request_body_file</code></p><p>带有请求正文的临时文件的名称</p><p>在处理结束时，文件需要被删除。想始终将请求主体写入文件中，需要启用 <a href="#client_body_in_file_only">client_body_in_file_only</a>。当临时文件的名称在代理请求中或在向 FastCGI/uwsgi/SCGI 服务器的请求中传递时，应该分别通过 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_proxy_module.html#proxy_pass_request_body" class="">proxy_pass_request_body off</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_fastcgi_module.html#fastcgi_pass_request_body" class="">fastcgi_pass_request_body off</a>、<a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_uwsgi_module.html#uwsgi_pass_request_body" class="">uwsgi_pass_request_body off</a> 或 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_scgi_module.html#scgi_pass_request_body" class="">scgi_pass_request_body off</a> 指令禁用传递请求正文。</p></li><li><p><code>$request_completion</code></p><p>如果请求已经完成，则返回 <code>OK</code>，否则返回空字符串</p></li><li><p><code>$request_filename</code></p><p>当前请求的文件路径，基于 <a href="#root">root</a> 或 <a href="#alias">alias</a> 指令以及请求 URI</p></li><li><p><code>$request_id</code></p><p>由 16 个随机字节生成的唯一请求标识符，以十六进制表示（1.11.0）</p></li><li><p><code>$request_length</code></p><p>请求长度（包括请求行、头部和请求体）（1.3.12、1.2.7）</p></li><li><p><code>$request_method</code></p><p>请求方法，通常为 <code>GET</code> 或 <code>POST</code></p></li><li><p><code>$request_time</code></p><p>请求处理时间以毫秒为单位（1.3.9、1.2.6）。自客户端读取第一个字节的时间起</p></li><li><p><code>$request_uri</code></p><p>完整的原始请求 URI（带参数）</p></li><li><p><code>$scheme</code></p><p>请求模式，<code>http</code> 或 <code>https</code></p></li><li><p><code>$sent_http_name</code></p><p>任意响应头字段。变量名称的最后一部分是将字段名称转换为小写，并用破折号替换为下划线</p></li><li><p><code>$sent_trailer_name</code></p><p>响应结束时发送的任意字段（1.13.2）。变量名称的最后一部分是将字段名称转换为小写，并用破折号替换为下划线</p></li><li><p><code>$server_addr</code></p><p>接受请求的服务器地址</p><p>通常需要一个系统调用来计算这个变量的值。为了避免系统调用，<a href="#listen">listen</a> 指令必须指定地址并使用 <code>bind</code> 参数。</p></li><li><p><code>$server_name</code></p><p>接受请求的服务器名称</p></li><li><p><code>$server_port</code></p><p>接受请求的服务器端口</p></li><li><p><code>$server_protocol</code></p><p>请求协议，通常为 <code>HTTP/1.0</code>、<code>HTTP/1.1</code> 或 <a href="/nginxdoc/%E6%A8%A1%E5%9D%97%E5%8F%82%E8%80%83/http/ngx_http_v2_module.html" class="">HTTP/2.0</a></p></li><li><p><code>$status</code></p><p>响应状态（1.3.2、1.2.2）</p></li><li><p><code>$tcpinfo_rtt</code>、<code>$tcpinfo_rttvar</code>、<code>$tcpinfo_snd_cwnd</code>、<code>$tcpinfo_rcv_space</code></p><p>有关客户端 TCP 连接的信息。在支持 <code>TCP_INFO</code> 套接字选项的系统上可用</p></li><li><p><code>$time_iso8601</code></p><p>本地时间采用 ISO 8601 标准格式（1.3.12、1.2.7）</p></li><li><p><code>$time_local</code></p><p>通用日志格式（Common Log Format）中的本地时间（1.3.12、1.2.7）</p></li><li><p><code>$uri</code></p><p><a href="#location">规范化</a>过的当前请求 URI</p><p><code>$uri</code> 的值可能在请求期间会改变</p></li></ul><h2 id="原文档" tabindex="-1"><a class="header-anchor" href="#原文档" aria-hidden="true">#</a> 原文档</h2><p><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/http/ngx_http_core_module.html<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a></p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">10/19/2021, 1:54:15 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: frisktale@live.com">frisktale</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/nginxdoc/assets/app.245ece3f.js" defer></script>
  </body>
</html>
